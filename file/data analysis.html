<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue.js Dashboard</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            background: white;
            padding: 20px 30px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 28px;
            font-weight: 700;
            color: #2c3e50;
            display: flex;
            align-items: center;
        }
        
        .logo-icon {
            margin-right: 12px;
            font-size: 32px;
        }
        
        .controls {
            display: flex;
            gap: 15px;
        }
        
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .btn-success {
            background: #2ecc71;
        }
        
        .btn-success:hover {
            background: #27ae60;
        }
        
        .btn:not(.btn-success) {
            background: #95a5a6;
        }
        
        .btn:not(.btn-success):hover {
            background: #7f8c8d;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid #3498db;
            color: #3498db;
        }
        
        .btn-outline:hover {
            background: #3498db;
            color: white;
        }
        
        .upload-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        
        .upload-area {
            border: 2px dashed #3498db;
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            margin: 20px 0;
            transition: all 0.3s ease;
            background: #f8fafc;
        }
        
        .upload-area:hover {
            background: #e3f2fd;
        }
        
        .upload-area.dragover {
            background: #bbdefb;
            border-color: #1565c0;
        }
        
        .upload-icon {
            font-size: 48px;
            color: #3498db;
            margin-bottom: 15px;
        }
        
        .file-input {
            display: none;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .card-title {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .data-table th {
            background: #f8f9fa;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #e9ecef;
        }
        
        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .data-table tr:hover {
            background: #f8f9fa;
        }
        
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .filter-label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }
        
        select, input {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            min-width: 180px;
        }
        
        /* ‰∏∫selectÊ∑ªÂä†ÊúÄÂ§ßÈ´òÂ∫¶ÂíåÊªöÂä® */
        select {
            max-height: 300px;
            overflow-y: auto;
        }
        
        /* ‰ºòÂåñÊªöÂä®Êù°Ê†∑Âºè */
        select::-webkit-scrollbar {
            width: 8px;
        }
        
        select::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        select::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        select::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* ÈíàÂØπProduct Type‰∏ãÊãâÊ°ÜÁöÑÁâπÊÆäÊ†∑Âºè */
        select[size] {
            height: auto !important;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #3498db;
            margin: 10px 0;
        }
        
        .stat-label {
            font-size: 14px;
            color: #7f8c8d;
            font-weight: 600;
        }
        
        .stat-change {
            display: flex;
            align-items: center;
            margin-top: 5px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .positive {
            color: #2ecc71;
        }
        
        .negative {
            color: #e74c3c;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .message {
            padding: 12px 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        
        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            header {
                flex-direction: column;
                gap: 15px;
            }
            
            .controls {
                width: 100%;
                justify-content: center;
            }
            
            .filters {
                flex-direction: column;
            }
            
            select, input {
                min-width: 100%;
            }
        }

        /* Cost Breakdown ÂçäÂÆΩÂ∏ÉÂ±Ä */
        .cost-breakdown-wrapper {
            display: flex;
            width: 100%;
            margin-top: 10px;
        }
        .cost-breakdown-card {
            width: 50%;
            min-width: 400px;
        }
        .cost-breakdown-card .chart-container {
            height: 300px !important;
        }
        @media (max-width: 1200px) {
            .cost-breakdown-card { width: 100%; }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <header style="padding: 15px 25px;">
                <div class="logo" style="font-size: 20px;">
                    <span class="logo-icon" style="font-size: 20px;">üìä</span>
                    Dashboard 
                </div>
                <div class="controls" style="gap: 10px;">
                    <button class="btn" @click="refreshData" style="padding: 8px 16px; font-size: 14px;">Refresh</button>
                    <button class="btn btn-outline" @click="exportData" style="padding: 8px 16px; font-size: 14px;">Export</button>
                    <button 
                        class="btn" 
                        :class="showUploadArea ? 'btn-outline' : 'btn-primary'"
                        @click="toggleUploadArea"
                        style="padding: 8px 16px; font-size: 14px; min-width: 120px;"
                    >
                        <span style="margin-right: 5px;">{{ showUploadArea ? 'üîº' : 'üîΩ' }}</span>
                        {{ showUploadArea ? 'ÈöêËóè‰∏ä‰º†' : 'Êñá‰ª∂‰∏ä‰º†' }}
                    </button>
                </div>
            </header>
            
            <!-- ‰∏ä‰º†Êñá‰ª∂Âå∫Âüü - Âπ∂ÊéíÂ∏ÉÂ±ÄÔºàÂèØÈöêËóèÔºâ -->
            <div v-show="showUploadArea" style="display: flex; gap: 20px; margin-bottom: 25px;">
                <!-- Sales Êñá‰ª∂‰∏ä‰º† -->
                <div class="upload-section" style="flex: 1; margin-bottom: 0;">
                    <h2>Upload Sales File</h2>
                    <p>Supports CSV and Excel files, with a maximum size of 50MB</p>
                    
                    <div 
                        class="upload-area" 
                        :class="{ 'dragover': isDragover }"
                        @drop="onDrop"
                        @dragover.prevent="isDragover = true"
                        @dragleave="isDragover = false"
                        @click="triggerFileInput"
                    >
                        <div class="upload-icon">üìÅ</div>
                        <p>Drag and drop files here, or <span style="color: #3498db; text-decoration: underline;">click to select files</span></p>
                        <p style="font-size: 12px; color: #7f8c8d; margin-top: 5px;">Supports selecting multiple files at once</p>
                        <p v-if="selectedFiles.length > 0" style="margin-top: 10px; font-weight: 600;">
                            Selected {{ selectedFiles.length }} files
                        </p>
                        <div v-if="selectedFiles.length > 0" style="margin-top: 10px; max-height: 100px; overflow-y: auto; font-size: 12px; text-align: left;">
                            <div v-for="(file, index) in selectedFiles" :key="index" style="padding: 2px 0;">
                                {{ index + 1 }}. {{ file.name }}
                            </div>
                        </div>
                        <input 
                            type="file" 
                            ref="fileInput" 
                            class="file-input" 
                            accept=".csv,.xlsx,.xls"
                            multiple
                            @change="onFileSelect"
                        >
                    </div>
                    
                    <div class="controls">
                        <button 
                            class="btn btn-success" 
                            @click="uploadFile" 
                            :disabled="selectedFiles.length === 0 || isUploading"
                        >
                            <span v-if="isUploading" class="loading"></span>
                            {{ isUploading ? 'Uploading...' : (selectedFiles.length > 0 ? `Upload ${selectedFiles.length} files` : 'Upload') }}
                        </button>
                        <button class="btn btn-outline" @click="clearData">
                            Clear Data
                        </button>
                    </div>
                    
                    <div v-if="totalRecords > 0" style="margin-top: 10px; color: #2c3e50; font-weight: 600;">
                        Loaded Data: {{ totalRecords }} records
                    </div>
                    
                    <div v-if="message" class="message" :class="messageType">
                        {{ message }}
                    </div>
                </div>
                
                <!-- Inventory Êñá‰ª∂‰∏ä‰º† -->
                <div class="upload-section" style="flex: 1; margin-bottom: 0;">
                    <h2>Upload Inventory File</h2>
                    <p>Upload Balance, Disc, or Pads Excel files to view inventory overview</p>
                    
                    <div>
                        <div 
                            class="upload-area" 
                            :class="{ 'dragover': isBalanceDragover }"
                            @drop="onBalanceDrop"
                            @dragover.prevent="isBalanceDragover = true"
                            @dragleave="isBalanceDragover = false"
                            @click="triggerBalanceFileInput"
                        >
                            <div class="upload-icon">üìä</div>
                            <p>Drag and drop inventory files here, or <span style="color: #3498db; text-decoration: underline;">click to select</span></p>
                            <p style="font-size: 12px; color: #7f8c8d; margin-top: 5px;">Supports Balance, Disc, and Pads files</p>
                            <p v-if="selectedBalanceFiles.length > 0" style="margin-top: 10px; font-weight: 600;">
                                Selected {{ selectedBalanceFiles.length }} file(s)
                            </p>
                            <div v-if="selectedBalanceFiles.length > 0" style="margin-top: 10px; max-height: 100px; overflow-y: auto; font-size: 12px; text-align: left;">
                                <div v-for="(file, index) in selectedBalanceFiles" :key="index" style="padding: 2px 0;">
                                    {{ index + 1 }}. {{ file.name }}
                                </div>
                            </div>
                            <input 
                                type="file" 
                                ref="balanceFileInput" 
                                class="file-input" 
                                accept=".xlsx,.xls"
                                multiple
                                @change="onBalanceFileSelect"
                            >
                        </div>
                        
                        <div class="controls">
                            <button 
                                class="btn btn-success" 
                                @click="uploadBalanceFile" 
                                :disabled="selectedBalanceFiles.length === 0 || isBalanceUploading"
                            >
                                <span v-if="isBalanceUploading" class="loading"></span>
                                {{ isBalanceUploading ? 'Uploading...' : (selectedBalanceFiles.length > 0 ? `Upload ${selectedBalanceFiles.length} file(s)` : 'Upload') }}
                            </button>
                            <button class="btn btn-outline" @click="clearInventoryData" style="margin-left:10px;">
                                Clear Data
                            </button>
                        </div>
                    </div>
                    
                    <div v-if="balanceRecords > 0" style="margin-top: 15px; padding: 10px; background: #e8f5e9; border-radius: 8px; color: #2c3e50; font-weight: 600;">
                        ‚úÖ Loaded Inventory Data
                    </div>
                </div>
            </div>
            
            <!-- Êï∞ÊçÆÁªüËÆ°ÊòæÁ§∫Ôºà‰ªÖÂú®ÈöêËóè‰∏ä‰º†Âå∫Êó∂ÊòæÁ§∫Ôºâ -->
            <div v-if="!showUploadArea && (totalRecords > 0 || balanceRecords > 0)" style="background:white; border-radius:12px; padding:15px 20px; margin-bottom:25px; box-shadow:0 4px 15px rgba(0,0,0,0.08); display:flex; gap:30px; align-items:center;">
                <div v-if="totalRecords > 0" style="display:flex; align-items:center; gap:10px;">
                    <span style="font-size:24px;">üìä</span>
                    <div>
                        <div style="font-size:12px; color:#7f8c8d;">Sales Data</div>
                        <div style="font-size:18px; font-weight:600; color:#2c3e50;">{{ formatNumber(totalRecords) }} records</div>
                    </div>
                </div>
                <div v-if="balanceRecords > 0" style="display:flex; align-items:center; gap:10px;">
                    <span style="font-size:24px;">üì¶</span>
                    <div>
                        <div style="font-size:12px; color:#7f8c8d;">Inventory Data</div>
                        <div style="font-size:18px; font-weight:600; color:#2c3e50;">{{ formatNumber(balanceRecords) }} records</div>
                    </div>
                </div>
            </div>
            
            <!-- View ÂàáÊç¢ÊåâÈíÆ -->
            <div style="background:white; border-radius:12px; padding:20px; margin-bottom:25px; box-shadow:0 4px 15px rgba(0,0,0,0.08);">
                <h3 style="margin:0 0 15px 0; font-size:18px; font-weight:600; color:#2c3e50;">View Selection</h3>
                <div style="display:flex; gap:15px;">
                    <button 
                        class="btn" 
                        :class="{ 'btn-success': currentView === 'sales' }"
                        @click="currentView = 'sales'"
                        style="flex:1; max-width:200px;"
                    >
                        üìä Sales
                    </button>
                    <button 
                        class="btn" 
                        :class="{ 'btn-success': currentView === 'inventory' }"
                        @click="currentView = 'inventory'"
                        style="flex:1; max-width:200px;"
                    >
                        üì¶ Inventory
                    </button>
                </div>
            </div>
            
            <!-- Sales È°µÈù¢ÂÜÖÂÆπ -->
            <div v-if="currentView === 'sales'">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Sales</div>
                        <div class="stat-value">{{ filteredStats.netSales ? '‚Ç¨' + formatNumber(filteredStats.netSales) : '‚Äî‚Äî' }}</div>
                    </div>
                <div class="stat-card">
                    <div class="stat-label">Sales Quantity</div>
                    <div class="stat-value">{{ filteredStats.salesQuantity ? formatNumber(filteredStats.salesQuantity) : '‚Äî‚Äî' }}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Net Sales</div>
                    <div class="stat-value">{{ filteredStats.netSales ? '‚Ç¨' + formatNumber(filteredStats.netSales) : '‚Äî‚Äî' }}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">USD</div>
                    <div class="stat-value">{{ filteredStats.usdAmount ? '$' + formatNumber(filteredStats.usdAmount) : '‚Äî‚Äî' }}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">RMB</div>
                    <div class="stat-value">{{ filteredStats.rmbAmount ? '¬•' + formatNumber(filteredStats.rmbAmount) : '‚Äî‚Äî' }}</div>
                </div>
            </div>
            
            <!-- Á≠õÈÄâÁªÑÂØπÊØîÂäüËÉΩ -->
            <div v-show="showFilterGroups" style="background:white; border-radius:12px; padding:20px; margin-bottom:25px; box-shadow:0 4px 15px rgba(0,0,0,0.08);">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <h3 style="margin:0;">Filter Groups</h3>
                    <button class="btn btn-success" @click="addFilterGroup" style="padding:8px 16px;">
                        <span style="font-size:18px; font-weight:bold;">+</span> Add Filter Group
                    </button>
                </div>
                
                <div v-for="(group, index) in filterGroups" :key="group.id" 
                     style="border:2px solid; border-radius:8px; padding:15px; margin-bottom:15px;"
                     :style="{ borderColor: group.borderColor, backgroundColor: group.color.replace('0.7', '0.05') }">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <div style="width:20px; height:20px; border-radius:4px;" :style="{ backgroundColor: group.color }"></div>
                            <input 
                                v-model="group.name" 
                                style="border:1px solid #ddd; padding:4px 8px; border-radius:4px; font-weight:600;"
                                placeholder="Group Name"
                            />
                        </div>
                        <button 
                            v-if="filterGroups.length > 1"
                            @click="removeFilterGroup(group.id)" 
                            class="btn" 
                            style="background:#e74c3c; padding:6px 12px;"
                        >
                            Âà†Èô§
                        </button>
                    </div>
                    
                    <div class="filters" style="margin:0;">
                        <div class="filter-group" v-if="viewMode === 'monthly'">
                            <label class="filter-label">Year</label>
                            <select v-model="group.filters.year">
                                <option value="all">All Years</option>
                                <option v-for="item in yearData" :key="item.year" :value="item.year">{{ item.year }}</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Region</label>
                            <select v-model="group.filters.region">
                                <option value="all">All Regions</option>
                                <option v-for="item in regionData" :key="item.region" :value="item.region">{{ item.region }}</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Country</label>
                            <select v-model="group.filters.country" style="max-height:300px; overflow-y:auto;">
                                <option value="all">All Countries</option>
                                <option v-for="country in countryOptions" :key="country" :value="country">{{ country }}</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Product Type</label>
                            <select v-model="group.filters.category" style="max-height:300px; overflow-y:auto;">
                                <option value="all">All Types</option>
                                <option v-for="item in productData" :key="item.category" :value="item.category">{{ item.category }}</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Customer</label>
                            <select v-model="group.filters.customer" style="max-height:300px; overflow-y:auto;">
                                <option value="all">All Customers</option>
                                <option v-for="cust in customerOptions" :key="cust" :value="cust">{{ cust }}</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Item Group</label>
                            <select v-model="group.filters.itemGroup" style="max-height:300px; overflow-y:auto;">
                                <option value="all">All Item Groups</option>
                                <option v-for="grp in itemGroupOptions" :key="grp" :value="grp">{{ grp }}</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Item Code</label>
                            <select v-model="group.filters.itemCode" style="max-height:300px; overflow-y:auto;">
                                <option value="all">All Item Codes</option>
                                <option v-for="code in itemCodeOptions" :key="code" :value="code">{{ code }}</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="filters" style="display:none;">
                <!-- ‰øùÁïôÂéüÊúâfiltersÂØπË±°‰ª•Áª¥ÊåÅÂêëÂêéÂÖºÂÆπ -->
                <div class="filter-group">
                    <label class="filter-label">View Mode</label>
                    <div style="display: flex; gap: 10px;">
                        <button 
                            @click="viewMode = 'yearly'" 
                            :class="['btn', viewMode === 'yearly' ? 'btn-success' : 'btn-outline']"
                            style="flex: 1;"
                        >
                            Yearly
                        </button>
                        <button 
                            @click="viewMode = 'monthly'" 
                            :class="['btn', viewMode === 'monthly' ? 'btn-success' : 'btn-outline']"
                            style="flex: 1;"
                        >
                            Monthly
                        </button>
                    </div>
                </div>
                <div class="filter-group" v-if="viewMode === 'monthly'">
                    <label class="filter-label">Year</label>
                    <select v-model="filters.year">
                        <option v-for="item in yearData" :key="item.year" :value="item.year">{{ item.year }}</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Region</label>
                    <select v-model="filters.region">
                        <option value="all">All Regions</option>
                        <option v-for="item in regionData" :key="item.region" :value="item.region">{{ item.region }}</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Country</label>
                    <select v-model="filters.country" style="max-height:300px; overflow-y:auto; min-width:180px;">
                        <option value="all">All Countries</option>
                        <option v-for="country in countryOptions" :key="country" :value="country">{{ country }}</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Product Type</label>
                    <select v-model="filters.category" style="max-height: 300px; overflow-y: auto;">
                        <option value="all">All Types</option>
                        <option v-for="item in productData" :key="item.category" :value="item.category">{{ item.category }}</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Customer</label>
                    <select v-model="filters.customer" style="max-height:300px; overflow-y:auto; min-width:240px;">
                        <option value="all">All Customers</option>
                        <option v-for="cust in customerOptions" :key="cust" :value="cust">{{ cust }}</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Item Group</label>
                    <select v-model="filters.itemGroup" style="max-height:300px; overflow-y:auto; min-width:220px;">
                        <option value="all">All Item Groups</option>
                        <option v-for="grp in itemGroupOptions" :key="grp" :value="grp">{{ grp }}</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Item Code</label>
                    <input type="text" v-model="itemCodeSearch" placeholder="ËæìÂÖ•ÊêúÁ¥¢ Item Code..." style="padding:8px 12px; border:1px solid #ddd; border-radius:6px; font-size:14px;" />
                    <select v-model="filters.itemCode" style="max-height:300px; overflow-y:auto; min-width:180px; margin-top:6px;">
                        <option value="all">All Item Codes</option>
                        <option v-for="code in filteredItemCodeOptions" :key="code" :value="code">{{ code }}</option>
                    </select>
                    <small style="color:#7f8c8d;">ÂÖ± {{ itemCodeOptions.length }} È°πÔºåÂ∑≤ËøáÊª§ {{ filteredItemCodeOptions.length }} È°π</small>
                </div>
            </div>
            
            <!-- View Mode ÊåâÈíÆÁßªÂà∞Á≠õÈÄâÁªÑ‰∏äÊñπ -->
            <div style="background:white; border-radius:12px; padding:20px; margin-bottom:25px; box-shadow:0 4px 15px rgba(0,0,0,0.08); display:flex; justify-content:space-between; align-items:center; gap:30px;">
                <div class="filter-group" style="flex:1; margin:0;">
                    <label class="filter-label" style="font-size:16px; font-weight:700;">View Mode</label>
                    <div style="display: flex; gap: 10px; margin-top:10px;">
                        <button 
                            @click="viewMode = 'yearly'" 
                            :class="['btn', viewMode === 'yearly' ? 'btn-success' : 'btn-outline']"
                            style="flex: 1; padding:12px 24px; font-size:16px;"
                        >
                            Yearly
                        </button>
                        <button 
                            @click="viewMode = 'monthly'" 
                            :class="['btn', viewMode === 'monthly' ? 'btn-success' : 'btn-outline']"
                            style="flex: 1; padding:12px 24px; font-size:16px;"
                        >
                            Monthly
                        </button>
                    </div>
                </div>
                <div style="display:flex; align-items:center; gap:10px;">
                    <button 
                        class="btn" 
                        :class="showFilterGroups ? 'btn-outline' : 'btn-primary'"
                        @click="toggleFilterGroups"
                        style="padding: 10px 20px; font-size: 14px; min-width: 140px; white-space: nowrap;"
                    >
                        <span style="margin-right: 5px;">{{ showFilterGroups ? 'üîº' : 'üîΩ' }}</span>
                        {{ showFilterGroups ? 'ÈöêËóèÁ≠õÈÄâÁªÑ' : 'ÊòæÁ§∫Á≠õÈÄâÁªÑ' }}
                    </button>
                </div>
            </div>
            
            <div class="dashboard">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Unit Price</div>
                    </div>
                    <div class="chart-container">
                        <canvas ref="unitPriceChart"></canvas>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Sales Quantity</div>
                    </div>
                    <div class="chart-container">
                        <canvas ref="salesQuantityChart"></canvas>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Gross Sales Amount</div>
                    </div>
                    <div class="chart-container">
                        <canvas ref="grossSalesChart"></canvas>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">EBIT</div>
                    </div>
                    <div class="chart-container">
                        <canvas ref="ebitChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Cost Breakdown Âå∫Âüü - Âπ∂ÊéíÂØπÊØî -->
            <div style="background:white; border-radius:12px; padding:25px; margin-bottom:25px; box-shadow:0 4px 15px rgba(0,0,0,0.08);">
                <h3 style="margin:0 0 20px 0; font-size:20px; font-weight:600; color:#2c3e50;">Cost Breakdown Comparison</h3>
                <div style="display:flex; gap:20px; flex-wrap:wrap;">
                    <div 
                        v-for="(group, index) in filterGroups" 
                        :key="group.id"
                        style="flex:1; min-width:500px; border:2px solid; border-radius:8px; padding:15px;"
                        :style="{ borderColor: group.borderColor }"
                    >
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
                            <div style="width:16px; height:16px; border-radius:4px;" :style="{ backgroundColor: group.color }"></div>
                            <h4 style="margin:0; font-size:16px; font-weight:600;">{{ group.name }}</h4>
                        </div>
                        <div style="position:relative; height:350px;">
                            <canvas :ref="el => { if (el) costBreakdownChartRefs[index] = el }"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            </div>
            
            <!-- Inventory È°µÈù¢ÂÜÖÂÆπ -->
            <div v-if="currentView === 'inventory'">
                <!-- Balance & Inventory Section -->
                <div style="background:white; border-radius:12px; padding:20px; margin-bottom:25px; box-shadow:0 4px 15px rgba(0,0,0,0.08);">
                    <h3 style="margin:0 0 15px 0; font-size:18px; font-weight:600; color:#2c3e50;">Inventory-Balance</h3>
                    
                    <!-- Êúà‰ªΩÈÄâÊã©Âô®Âíå Overall/Goods in Transit Âç°Áâá -->
                    <div style="display:grid; grid-template-columns: 300px 1fr; gap:20px; align-items:start;">
                        <!-- Â∑¶‰æßÔºöÊúà‰ªΩÈÄâÊã©Âô® -->
                        <div>
                            <div class="filter-group">
                                <label class="filter-label">Date</label>
                                <select v-model="selectedBalanceMonth" style="width:100%;">
                                    <option value="">-- Select Month --</option>
                                    <option v-for="month in balanceMonthOptions" :key="month" :value="month">{{ month }}</option>
                                </select>
                            </div>
                            
                            <!-- Êú™ÈÄâÊã©Êúà‰ªΩÊó∂ÁöÑÊèêÁ§∫ -->
                            <div v-if="!selectedBalanceMonth" style="margin-top:15px; padding:15px; background:#f8f9fa; border-radius:8px; text-align:center;">
                                <div style="font-size:40px; margin-bottom:10px;">üìÖ</div>
                                <p style="color:#7f8c8d; font-size:14px; margin:0;">
                                    Select a month to view balance data
                                </p>
                            </div>
                        </div>
                        
                        <!-- Âè≥‰æßÔºöOverall Âíå Goods in Transit Âç°Áâá -->
                        <div v-if="selectedBalanceMonth">
                            <div class="stats-grid" style="grid-template-columns: repeat(2, 1fr); gap:15px;">
                                <div class="stat-card">
                                    <div class="stat-label">Overall</div>
                                    <div class="stat-value">{{ formatNumber(selectedBalanceData?.overall || 0) }}</div>
                                    <div class="stat-label" style="margin-top:8px; color:#888; font-size:14px;">{{ selectedBalanceMonth }}</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-label">Goods in Transit</div>
                                    <div class="stat-value">{{ formatNumber(selectedBalanceData?.goodsInTransit || 0) }}</div>
                                    <div class="stat-label" style="margin-top:8px; color:#888; font-size:14px;">{{ selectedBalanceMonth }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Inventory-Category Section (ÊåâÊúà‰ªΩÊòæÁ§∫) -->
                <div style="background:white; border-radius:12px; padding:20px; margin-bottom:25px; box-shadow:0 4px 15px rgba(0,0,0,0.08);">
                    <h3 style="margin:0 0 15px 0; font-size:18px; font-weight:600; color:#2c3e50;">Inventory-Category</h3>
                    
                    <!-- Êúà‰ªΩÈÄâÊã©Âô® -->
                    <div style="margin-bottom:20px;">
                        <div class="filter-group" style="max-width:300px;">
                            <label class="filter-label">Select Month</label>
                            <!-- ‰øÆÂ§çÔºöÂ∫î‰ΩøÁî® Inventory Category ÁöÑÊúà‰ªΩÈõÜÂêàÂíå selectedCategoryMonth ÁªëÂÆö -->
                            <select v-model="selectedCategoryMonth" style="width:100%;">
                                <option value="">-- Select Month --</option>
                                <option v-for="month in categoryMonthOptions" :key="month" :value="month">{{ month }}</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- ÂàÜÁ±ªÁªüËÆ°Âç°Áâá -->
                    <div class="stats-grid" style="grid-template-columns: repeat(2, 1fr); gap:15px;">
                        <div class="stat-card">
                            <div class="stat-label">Disc</div>
                            <div class="stat-value">{{ formatNumber(selectedCategoryMonth ? discStatsByMonth.value : discStatsAll.value) }}</div>
                            <div class="stat-label" style="margin-top:8px; color:#888; font-size:14px;">Qty: {{ formatNumber(selectedCategoryMonth ? discStatsByMonth.qty : discStatsAll.qty) }}</div>
                            <div class="stat-label" style="margin-top:4px; color:#888; font-size:12px;">
                                {{ selectedCategoryMonth || (discMonths.length + ' months') }}
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Pads</div>
                            <div class="stat-value">{{ formatNumber(selectedCategoryMonth ? padsStatsByMonth.value : padsStatsAll.value) }}</div>
                            <div class="stat-label" style="margin-top:8px; color:#888; font-size:14px;">Qty: {{ formatNumber(selectedCategoryMonth ? padsStatsByMonth.qty : padsStatsAll.qty) }}</div>
                            <div class="stat-label" style="margin-top:4px; color:#888; font-size:12px;">
                                {{ selectedCategoryMonth || (padsMonths.length + ' months') }}
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Moto</div>
                            <div class="stat-value">{{ formatNumber(selectedCategoryMonth ? motoStatsByMonth.value : motoStatsAll.value) }}</div>
                            <div class="stat-label" style="margin-top:8px; color:#888; font-size:14px;">Qty: {{ formatNumber(selectedCategoryMonth ? motoStatsByMonth.qty : motoStatsAll.qty) }}</div>
                            <div class="stat-label" style="margin-top:4px; color:#888; font-size:12px;">
                                {{ selectedCategoryMonth || (motoMonths.length ? motoMonths.length + ' months' : 'No data') }}
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Fluid</div>
                            <div class="stat-value">{{ formatNumber(selectedCategoryMonth ? fluidStatsByMonth.value : fluidStatsAll.value) }}</div>
                            <div class="stat-label" style="margin-top:8px; color:#888; font-size:14px;">Qty: {{ formatNumber(selectedCategoryMonth ? fluidStatsByMonth.qty : fluidStatsAll.qty) }}</div>
                            <div class="stat-label" style="margin-top:4px; color:#888; font-size:12px;">
                                {{ selectedCategoryMonth || (fluidMonths.length ? fluidMonths.length + ' months' : 'No data') }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Combined DIO Analysis Section -->
            <div v-if="currentView === 'inventory'" style="background:white; padding:20px; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1); margin-top:20px;">
                <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:15px;">
                    <h3 style="margin:0; font-size:18px; font-weight:600; color:#2c3e50;">DIO Analysis - All Categories</h3>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <label style="font-size:14px; color:#666;">From:</label>
                        <select v-model="selectedCombinedDioStartMonth" style="padding:6px 12px; border:1px solid #ddd; border-radius:4px; font-size:14px;">
                            <option value="">Start Month</option>
                            <option v-for="month in combinedDioMonths" :key="month" :value="month">{{ month }}</option>
                        </select>
                        <label style="font-size:14px; color:#666;">To:</label>
                        <select v-model="selectedCombinedDioEndMonth" style="padding:6px 12px; border:1px solid #ddd; border-radius:4px; font-size:14px;">
                            <option value="">End Month</option>
                            <option v-for="month in combinedDioMonths" :key="month" :value="month">{{ month }}</option>
                        </select>
                    </div>
                </div>
                
                <!-- Category Toggle Buttons -->
                <div style="display:flex; gap:10px; margin-bottom:15px; flex-wrap:wrap;">
                    <button 
                        @click="toggleDioCategory('disc')"
                        :class="['btn', dioVisibility.disc ? 'btn-success' : 'btn-outline']"
                        style="padding:8px 16px; display:flex; align-items:center; gap:8px;"
                    >
                        <div style="width:16px; height:16px; border-radius:3px; background:rgba(52, 152, 219, 0.7);"></div>
                        Disc
                    </button>
                    <button 
                        @click="toggleDioCategory('pads')"
                        :class="['btn', dioVisibility.pads ? 'btn-success' : 'btn-outline']"
                        style="padding:8px 16px; display:flex; align-items:center; gap:8px;"
                    >
                        <div style="width:16px; height:16px; border-radius:3px; background:rgba(46, 204, 113, 0.7);"></div>
                        Pads
                    </button>
                    <button 
                        @click="toggleDioCategory('moto')"
                        :class="['btn', dioVisibility.moto ? 'btn-success' : 'btn-outline']"
                        style="padding:8px 16px; display:flex; align-items:center; gap:8px;"
                    >
                        <div style="width:16px; height:16px; border-radius:3px; background:rgba(155, 89, 182, 0.7);"></div>
                        Moto
                    </button>
                    <button 
                        @click="toggleDioCategory('fluid')"
                        :class="['btn', dioVisibility.fluid ? 'btn-success' : 'btn-outline']"
                        style="padding:8px 16px; display:flex; align-items:center; gap:8px;"
                    >
                        <div style="width:16px; height:16px; border-radius:3px; background:rgba(230, 126, 34, 0.7);"></div>
                        Fluid
                    </button>
                    <button 
                        @click="toggleDioCategory('total')"
                        :class="['btn', dioVisibility.total ? 'btn-success' : 'btn-outline']"
                        style="padding:8px 16px; display:flex; align-items:center; gap:8px; font-weight:700; border-width:2px;"
                    >
                        <div style="width:16px; height:16px; border-radius:3px; background:rgba(231, 76, 60, 0.7);"></div>
                        Total
                    </button>
                </div>
                
                <div style="position:relative; height:400px;">
                    <canvas ref="combinedDioChartRef"></canvas>
                </div>
            </div>
            
            <footer>
                <p>¬©
                    
                    Vue.js Êï∞ÊçÆÂèØËßÜÂåñÂπ≥Âè∞</p>
            </footer>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted, watch, nextTick, computed } = Vue;
        
        createApp({
            setup() {
                // ÂìçÂ∫îÂºèÊï∞ÊçÆ
                const unitPriceChart = ref(null);
                const salesQuantityChart = ref(null);
                const grossSalesChart = ref(null);
                const ebitChart = ref(null);
                const costBreakdownChart = ref(null);
                const fileInput = ref(null);
                
                const chartType = ref('bar');
                const charts = ref({});
                const viewMode = ref('yearly'); // 'yearly' Êàñ 'monthly'
                const currentView = ref('sales'); // 'sales' Êàñ 'inventory'
                
                const filters = ref({
                    year: 'all',
                    month: 'all',
                    region: 'all',
                    country: 'all',
                    category: 'all',
                    customer: 'all',
                    itemGroup: 'all',
                    itemCode: 'all'
                });
                
                // Â§öÁ≠õÈÄâÁªÑÂØπÊØîÂäüËÉΩ
                const filterGroups = ref([
                    {
                        id: 1,
                        name: 'Group 1',
                        color: 'rgba(52, 152, 219, 0.7)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        filters: {
                            year: 'all',
                            month: 'all',
                            region: 'all',
                            country: 'all',
                            category: 'all',
                            customer: 'all',
                            itemGroup: 'all',
                            itemCode: 'all'
                        }
                    }
                ]);
                const nextGroupId = ref(2);
                const colorPalette = [
                    { bg: 'rgba(52, 152, 219, 0.7)', border: 'rgba(52, 152, 219, 1)' },
                    { bg: 'rgba(46, 204, 113, 0.7)', border: 'rgba(46, 204, 113, 1)' },
                    { bg: 'rgba(155, 89, 182, 0.7)', border: 'rgba(155, 89, 182, 1)' },
                    { bg: 'rgba(230, 126, 34, 0.7)', border: 'rgba(230, 126, 34, 1)' },
                    { bg: 'rgba(231, 76, 60, 0.7)', border: 'rgba(231, 76, 60, 1)' },
                    { bg: 'rgba(241, 196, 15, 0.7)', border: 'rgba(241, 196, 15, 1)' },
                    { bg: 'rgba(26, 188, 156, 0.7)', border: 'rgba(26, 188, 156, 1)' }
                ];
                
                // Cost Breakdown ÂõæË°®ÂºïÁî®Êï∞ÁªÑ
                const costBreakdownChartRefs = ref([]);
                
                const stats = ref({
                    totalSales: 0,
                    salesQuantity: 0,
                    netSales: 0,
                    usdAmount: 0,
                    rmbAmount: 0
                });
                
                const salesData = ref([]);
                const productData = ref([]);
                const regionData = ref([]);
                const yearData = ref([]);
                const yearlySummaryData = ref([]);
                const monthlySummaryData = ref([]);
                const costBreakdownData = ref([]);
                // Item Code ÊêúÁ¥¢ÂÖ≥ÈîÆÂ≠ó
                const itemCodeSearch = ref('');
                
                const selectedFiles = ref([]);
                const isUploading = ref(false);
                const isDragover = ref(false);
                const message = ref('');
                const messageType = ref('');
                const totalRecords = ref(0);
                
                // Balance Áõ∏ÂÖ≥Êï∞ÊçÆ
                const balanceFileInput = ref(null);
                const balanceOverviewChart = ref(null);
                const selectedBalanceFiles = ref([]);
                const isBalanceUploading = ref(false);
                const isBalanceDragover = ref(false);
                const showUploadArea = ref(false);  // ÊéßÂà∂‰∏ä‰º†Âå∫ÂüüÊòæÁ§∫/ÈöêËóè
                const showFilterGroups = ref(false);  // ÊéßÂà∂Á≠õÈÄâÁªÑÊòæÁ§∫/ÈöêËóè
                const balanceRecords = ref(0);
                const balanceOverview = ref({
                    overall: [],
                    goodsInTransit: []
                });
                const selectedBalanceMonth = ref('');
                const selectedCategoryMonth = ref('');  // Inventory-Category Êúà‰ªΩÈÄâÊã©
                // Disc & Pads & Moto & Fluid Êï∞ÊçÆ
                const discStats = ref({ value: 0, qty: 0 });
                const padsStats = ref({ value: 0, qty: 0 });
                const motoStats = ref({ value: 0, qty: 0 });
                const fluidStats = ref({ value: 0, qty: 0 });
                const discMonths = ref([]);
                const padsMonths = ref([]);
                const motoMonths = ref([]);
                const fluidMonths = ref([]);
                const discAllData = ref([]);  // Â≠òÂÇ®ÊâÄÊúâ Disc Êï∞ÊçÆ
                const padsAllData = ref([]);  // Â≠òÂÇ®ÊâÄÊúâ Pads Êï∞ÊçÆ
                const motoAllData = ref([]);  // Â≠òÂÇ®ÊâÄÊúâ Moto Êï∞ÊçÆ
                const fluidAllData = ref([]);  // Â≠òÂÇ®ÊâÄÊúâ Fluid Êï∞ÊçÆ
                
                // DIO Áõ∏ÂÖ≥Êï∞ÊçÆ - Disc
                const dioData = ref([]);
                const dioMonths = ref([]);
                const selectedDioStartMonth = ref('');
                const selectedDioEndMonth = ref('');
                const dioChartRef = ref(null);
                let dioChartInstance = null;
                
                // DIO Áõ∏ÂÖ≥Êï∞ÊçÆ - Pads
                const padsDioData = ref([]);
                const padsDioMonths = ref([]);
                const selectedPadsDioStartMonth = ref('');
                const selectedPadsDioEndMonth = ref('');
                const padsDioChartRef = ref(null);
                let padsDioChartInstance = null;
                
                // DIO Áõ∏ÂÖ≥Êï∞ÊçÆ - Moto
                const motoDioData = ref([]);
                const motoDioMonths = ref([]);
                const selectedMotoDioStartMonth = ref('');
                const selectedMotoDioEndMonth = ref('');
                const motoDioChartRef = ref(null);
                let motoDioChartInstance = null;
                
                // DIO Áõ∏ÂÖ≥Êï∞ÊçÆ - Fluid
                const fluidDioData = ref([]);
                const fluidDioMonths = ref([]);
                const selectedFluidDioStartMonth = ref('');
                const selectedFluidDioEndMonth = ref('');
                const fluidDioChartRef = ref(null);
                let fluidDioChartInstance = null;
                
                // ÁªÑÂêà DIO ÂõæË°®Áõ∏ÂÖ≥Êï∞ÊçÆ
                const combinedDioChartRef = ref(null);
                let combinedDioChartInstance = null;
                const selectedCombinedDioStartMonth = ref('');
                const selectedCombinedDioEndMonth = ref('');
                const dioVisibility = ref({
                    disc: false,
                    pads: false,
                    moto: false,
                    fluid: false,
                    total: true
                });
                // ÂΩìÂâçÊøÄÊ¥ªÁöÑ DIO Á±ªÂà´ÔºàÁî®‰∫éÊéßÂà∂Âè™ÊòæÁ§∫‰∏Ä‰∏™Á±ªÂà´Ôºâ
                const activeDioCategory = ref('total');
                
                // Total DIO Áõ∏ÂÖ≥Êï∞ÊçÆ
                const totalDioData = ref([]);
                const totalDioMonths = ref([]);
                const totalDioChartRef = ref(null);
                let totalDioChartInstance = null;
                
                // ËÆ∞ÂΩïÊï∞ÁªüËÆ°
                const discRecords = ref(0);
                const padsRecords = ref(0);
                const motoRecords = ref(0);
                const fluidRecords = ref(0);
                
                // ÊØèÊúàÂáÄÈîÄÂîÆÈ¢ùÂ≠óÂÖ∏
                const monthlyNetSales = ref({});
                
                // Disc ÊØèÊúàÂáÄÈîÄÂîÆÈ¢ùÂ≠óÂÖ∏
                const discMonthlyNetSales = ref({});
                
                // Pads ÊØèÊúàÂáÄÈîÄÂîÆÈ¢ùÂ≠óÂÖ∏
                const padsMonthlyNetSales = ref({});
                
                // Moto ÊØèÊúàÂáÄÈîÄÂîÆÈ¢ùÂ≠óÂÖ∏
                const motoMonthlyNetSales = ref({});
                
                // Fluid ÊØèÊúàÂáÄÈîÄÂîÆÈ¢ùÂ≠óÂÖ∏
                const fluidMonthlyNetSales = ref({});

                // Âä†ËΩΩ Disc ÂèØÁî®Êúà‰ªΩÂíåÊâÄÊúâÊï∞ÊçÆ
                const loadDiscMonths = async () => {
                    try {
                        // ‰ΩøÁî®‰∏ìÈó®ÁöÑÊúà‰ªΩÊé•Âè£,ÈÅøÂÖçÂä†ËΩΩÊâÄÊúâÊï∞ÊçÆ
                        const monthsResponse = await fetch(`${API_BASE}/data/disc/months`);
                        const monthsList = await monthsResponse.json();
                        discMonths.value = monthsList;
                        console.log('Disc ÂèØÁî®Êúà‰ªΩ:', discMonths.value);
                        
                        // ‰ªçÁÑ∂Âä†ËΩΩÈÉ®ÂàÜÊï∞ÊçÆÁî®‰∫éÁªüËÆ°
                        const response = await fetch(`${API_BASE}/data/disc?limit=10000`);
                        const raw = await response.json();
                        const data = Array.isArray(raw) ? raw : (Array.isArray(raw.data) ? raw.data : []);
                        discAllData.value = data;
                        console.log('Disc Êï∞ÊçÆÂä†ËΩΩ:', data.length, 'Êù° (Áî®‰∫éÂø´ÈÄüÁªüËÆ°)');
                    } catch (e) {
                        console.error('Error loading disc months:', e);
                        discMonths.value = [];
                        discAllData.value = [];
                    }
                };

                // Âä†ËΩΩ Disc Êï∞ÊçÆ
                const loadDiscStats = async (month) => {
                    discStats.value = { value: 0, qty: 0 };
                    if (!month) return;
                    try {
                        const response = await fetch(`${API_BASE}/data/disc`);
                        const raw = await response.json();
                        const data = Array.isArray(raw) ? raw : (Array.isArray(raw.data) ? raw.data : []);
                        const total = Array.isArray(raw) ? raw.length : (raw.totalRecords ?? data.length);
                        console.log('Disc data received (ÂÖºÂÆπÂàÜÈ°µ):', total, 'records');
                        // Â≠óÊÆµ: year_month, Inventory value, On-hand
                        const filtered = data.filter(item => item.year_month === month);
                        console.log('Filtered disc data for', month, ':', filtered.length, 'records');
                        discStats.value.value = filtered.reduce((sum, item) => sum + (Number(item['Inventory value']) || 0), 0);
                        discStats.value.qty = filtered.reduce((sum, item) => sum + (Number(item['On-hand']) || 0), 0);
                        console.log('Disc stats:', discStats.value);
                    } catch (e) { 
                        console.error('Error loading disc stats:', e);
                        discStats.value = { value: 0, qty: 0 }; 
                    }
                };

                // Âä†ËΩΩ Pads ÂèØÁî®Êúà‰ªΩÂíåÊâÄÊúâÊï∞ÊçÆ
                const loadPadsMonths = async () => {
                    try {
                        // ‰ΩøÁî®‰∏ìÈó®ÁöÑÊúà‰ªΩÊé•Âè£
                        const monthsResponse = await fetch(`${API_BASE}/data/pads/months`);
                        const monthsList = await monthsResponse.json();
                        padsMonths.value = monthsList;
                        console.log('Pads ÂèØÁî®Êúà‰ªΩ:', padsMonths.value);
                        
                        // Âä†ËΩΩÊâÄÊúâÊï∞ÊçÆÁî®‰∫éÁªüËÆ°
                        const response = await fetch(`${API_BASE}/data/pads`);
                        const data = await response.json();
                        padsAllData.value = data;
                        console.log('Pads ÊÄªËÆ∞ÂΩïÊï∞:', data.length);
                    } catch (e) {
                        console.error('Error loading pads months:', e);
                        padsMonths.value = [];
                        padsAllData.value = [];
                    }
                };

                // Âä†ËΩΩ Pads Êï∞ÊçÆ
                const loadPadsStats = async (month) => {
                    padsStats.value = { value: 0, qty: 0 };
                    if (!month) return;
                    try {
                        const response = await fetch(`${API_BASE}/data/pads`);
                        const data = await response.json();
                        console.log('Pads data received:', data.length, 'records');
                        // Â≠óÊÆµ: year_month, Inventory value, On-hand
                        const filtered = data.filter(item => item.year_month === month);
                        console.log('Filtered pads data for', month, ':', filtered.length, 'records');
                        padsStats.value.value = filtered.reduce((sum, item) => sum + (Number(item['Inventory value']) || 0), 0);
                        padsStats.value.qty = filtered.reduce((sum, item) => sum + (Number(item['On-hand']) || 0), 0);
                        console.log('Pads stats:', padsStats.value);
                    } catch (e) { 
                        console.error('Error loading pads stats:', e);
                        padsStats.value = { value: 0, qty: 0 }; 
                    }
                };

                // Âä†ËΩΩ Moto ÂèØÁî®Êúà‰ªΩÂíåÊâÄÊúâÊï∞ÊçÆ
                const loadMotoMonths = async () => {
                    try {
                        // ‰ΩøÁî®‰∏ìÈó®ÁöÑÊúà‰ªΩÊé•Âè£
                        const monthsResponse = await fetch(`${API_BASE}/data/moto/months`);
                        const monthsList = await monthsResponse.json();
                        motoMonths.value = monthsList;
                        console.log('Moto ÂèØÁî®Êúà‰ªΩ:', motoMonths.value);
                        
                        // Âä†ËΩΩÊâÄÊúâÊï∞ÊçÆÁî®‰∫éÁªüËÆ°
                        const response = await fetch(`${API_BASE}/data/moto`);
                        const data = await response.json();
                        motoAllData.value = data;
                        console.log('Moto ÊÄªËÆ∞ÂΩïÊï∞:', data.length);
                    } catch (e) {
                        console.error('Error loading moto months:', e);
                        motoMonths.value = [];
                        motoAllData.value = [];
                    }
                };

                // Âä†ËΩΩ Moto Êï∞ÊçÆ
                const loadMotoStats = async (month) => {
                    motoStats.value = { value: 0, qty: 0 };
                    if (!month) return;
                    try {
                        const response = await fetch(`${API_BASE}/data/moto`);
                        const data = await response.json();
                        console.log('Moto data received:', data.length, 'records');
                        const filtered = data.filter(item => item.year_month === month);
                        console.log('Filtered moto data for', month, ':', filtered.length, 'records');
                        motoStats.value.value = filtered.reduce((sum, item) => sum + (Number(item['Inventory value']) || 0), 0);
                        motoStats.value.qty = filtered.reduce((sum, item) => sum + (Number(item['On-hand']) || 0), 0);
                        console.log('Moto stats:', motoStats.value);
                    } catch (e) { 
                        console.error('Error loading moto stats:', e);
                        motoStats.value = { value: 0, qty: 0 }; 
                    }
                };

                // Âä†ËΩΩ Fluid ÂèØÁî®Êúà‰ªΩÂíåÊâÄÊúâÊï∞ÊçÆ
                const loadFluidMonths = async () => {
                    try {
                        // ‰ΩøÁî®‰∏ìÈó®ÁöÑÊúà‰ªΩÊé•Âè£
                        const monthsResponse = await fetch(`${API_BASE}/data/fluid/months`);
                        const monthsList = await monthsResponse.json();
                        fluidMonths.value = monthsList;
                        console.log('Fluid ÂèØÁî®Êúà‰ªΩ:', fluidMonths.value);
                        
                        // Âä†ËΩΩÊâÄÊúâÊï∞ÊçÆÁî®‰∫éÁªüËÆ°
                        const response = await fetch(`${API_BASE}/data/fluid`);
                        const data = await response.json();
                        fluidAllData.value = data;
                        console.log('Fluid ÊÄªËÆ∞ÂΩïÊï∞:', data.length);
                    } catch (e) {
                        console.error('Error loading fluid months:', e);
                        fluidMonths.value = [];
                        fluidAllData.value = [];
                    }
                };

                // Âä†ËΩΩ Fluid Êï∞ÊçÆ
                const loadFluidStats = async (month) => {
                    fluidStats.value = { value: 0, qty: 0 };
                    if (!month) return;
                    try {
                        const response = await fetch(`${API_BASE}/data/fluid`);
                        const data = await response.json();
                        console.log('Fluid data received:', data.length, 'records');
                        const filtered = data.filter(item => item.year_month === month);
                        console.log('Filtered fluid data for', month, ':', filtered.length, 'records');
                        fluidStats.value.value = filtered.reduce((sum, item) => sum + (Number(item['Inventory value']) || 0), 0);
                        fluidStats.value.qty = filtered.reduce((sum, item) => sum + (Number(item['On-hand']) || 0), 0);
                        console.log('Fluid stats:', fluidStats.value);
                    } catch (e) { 
                        console.error('Error loading fluid stats:', e);
                        fluidStats.value = { value: 0, qty: 0 }; 
                    }
                };

                // Âä†ËΩΩ DIO Êï∞ÊçÆ
                const loadDioData = async () => {
                    try {
                        const response = await fetch(`${API_BASE}/data/disc/dio`);
                        const data = await response.json();
                        dioData.value = data;
                        dioMonths.value = data.map(item => item.year_month);
                        // Áî® DIO Êï∞ÊçÆÂ°´ÂÖÖ Disc ÊØèÊúàÂáÄÈîÄÂîÆÈ¢ù
                        const discNetSalesDict = {};
                        data.forEach(item => {
                            if (item.year_month && item.net_sales_month !== undefined) {
                                discNetSalesDict[item.year_month] = item.net_sales_month;
                            }
                        });
                        discMonthlyNetSales.value = discNetSalesDict;
                        console.log('DIO data loaded:', data.length, 'months');
                    } catch (e) {
                        console.error('Error loading DIO data:', e);
                        dioData.value = [];
                        dioMonths.value = [];
                        discMonthlyNetSales.value = {};
                    }
                };

                // Ê∏≤Êüì DIO ÊäòÁ∫øÂõæ
                const renderDioChart = () => {
                    if (!dioChartRef.value) return;

                    const ctx = dioChartRef.value.getContext('2d');
                    
                    // ÈîÄÊØÅÂ∑≤ÊúâÂõæË°®
                    if (dioChartInstance) {
                        dioChartInstance.destroy();
                    }

                    // ËøáÊª§Êï∞ÊçÆÔºàÊåâÊó•ÊúüËåÉÂõ¥Ôºâ
                    let chartData = dioData.value;
                    if (selectedDioStartMonth.value || selectedDioEndMonth.value) {
                        chartData = dioData.value.filter(item => {
                            const itemMonth = item.year_month;
                            const startOk = !selectedDioStartMonth.value || itemMonth >= selectedDioStartMonth.value;
                            const endOk = !selectedDioEndMonth.value || itemMonth <= selectedDioEndMonth.value;
                            return startOk && endOk;
                        });
                    }

                    // ‰ªÖÊòæÁ§∫Êúâ DIO ÂÄºÁöÑÊï∞ÊçÆÁÇπ
                    const validData = chartData.filter(item => item.dio !== null && item.dio !== undefined);

                    dioChartInstance = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: validData.map(item => item.year_month),
                            datasets: [{
                                label: 'DIO (Days)',
                                data: validData.map(item => item.dio),
                                borderColor: 'rgba(52, 152, 219, 1)',
                                backgroundColor: 'rgba(52, 152, 219, 0.1)',
                                borderWidth: 2,
                                pointRadius: 4,
                                pointHoverRadius: 6,
                                tension: 0.3,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'top'
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const item = validData[context.dataIndex];
                                            return [
                                                `DIO: ${item.dio.toFixed(2)} days`,
                                                `Inventory: ${item.inventory_value.toLocaleString()}`,
                                                `12M Sales: ${item.sales_12m ? item.sales_12m.toLocaleString() : 'N/A'}`
                                            ];
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Days Inventory Outstanding'
                                    }
                                },
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Month'
                                    }
                                }
                            }
                        }
                    });
                };

                // Âä†ËΩΩ Pads DIO Êï∞ÊçÆ
                const loadPadsDioData = async () => {
                    try {
                        const response = await fetch(`${API_BASE}/data/pads/dio`);
                        const data = await response.json();
                        padsDioData.value = data;
                        padsDioMonths.value = data.map(item => item.year_month);
                        // Áî® DIO Êï∞ÊçÆÂ°´ÂÖÖ Pads ÊØèÊúàÂáÄÈîÄÂîÆÈ¢ù
                        const padsNetSalesDict = {};
                        data.forEach(item => {
                            if (item.year_month && item.net_sales_month !== undefined) {
                                padsNetSalesDict[item.year_month] = item.net_sales_month;
                            }
                        });
                        padsMonthlyNetSales.value = padsNetSalesDict;
                        console.log('Pads DIO data loaded:', data.length, 'months');
                    } catch (e) {
                        console.error('Error loading Pads DIO data:', e);
                        padsDioData.value = [];
                        padsDioMonths.value = [];
                        padsMonthlyNetSales.value = {};
                    }
                };

                // Ê∏≤Êüì Pads DIO ÊäòÁ∫øÂõæ
                const renderPadsDioChart = () => {
                    if (!padsDioChartRef.value) return;
                    const ctx = padsDioChartRef.value.getContext('2d');
                    if (padsDioChartInstance) padsDioChartInstance.destroy();

                    let chartData = padsDioData.value;
                    if (selectedPadsDioStartMonth.value || selectedPadsDioEndMonth.value) {
                        chartData = padsDioData.value.filter(item => {
                            const itemMonth = item.year_month;
                            const startOk = !selectedPadsDioStartMonth.value || itemMonth >= selectedPadsDioStartMonth.value;
                            const endOk = !selectedPadsDioEndMonth.value || itemMonth <= selectedPadsDioEndMonth.value;
                            return startOk && endOk;
                        });
                    }

                    const validData = chartData.filter(item => item.dio !== null && item.dio !== undefined);
                    padsDioChartInstance = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: validData.map(item => item.year_month),
                            datasets: [{
                                label: 'DIO (Days)',
                                data: validData.map(item => item.dio),
                                borderColor: 'rgba(0,100,0, 1)',
                                backgroundColor: 'rgba(0,100,0, 0.1)',
                                borderWidth: 2,
                                pointRadius: 4,
                                pointHoverRadius: 6,
                                tension: 0.3,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: true, position: 'top' },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const item = validData[context.dataIndex];
                                            return [
                                                `DIO: ${item.dio.toFixed(2)} days`,
                                                `Inventory: ${item.inventory_value.toLocaleString()}`,
                                                `12M Sales: ${item.sales_12m ? item.sales_12m.toLocaleString() : 'N/A'}`
                                            ];
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: { beginAtZero: true, title: { display: true, text: 'Days Inventory Outstanding' } },
                                x: { title: { display: true, text: 'Month' } }
                            }
                        }
                    });
                };

                // Âä†ËΩΩ Moto DIO Êï∞ÊçÆ
                const loadMotoDioData = async () => {
                    try {
                        const response = await fetch(`${API_BASE}/data/moto/dio`);
                        const data = await response.json();
                        motoDioData.value = data;
                        motoDioMonths.value = data.map(item => item.year_month);
                        // Áî® DIO Êï∞ÊçÆÂ°´ÂÖÖ Moto ÊØèÊúàÂáÄÈîÄÂîÆÈ¢ù
                        const motoNetSalesDict = {};
                        data.forEach(item => {
                            if (item.year_month && item.net_sales_month !== undefined) {
                                motoNetSalesDict[item.year_month] = item.net_sales_month;
                            }
                        });
                        motoMonthlyNetSales.value = motoNetSalesDict;
                        console.log('Moto DIO data loaded:', data.length, 'months');
                    } catch (e) {
                        console.error('Error loading Moto DIO data:', e);
                        motoDioData.value = [];
                        motoDioMonths.value = [];
                        motoMonthlyNetSales.value = {};
                    }
                };

                // Ê∏≤Êüì Moto DIO ÊäòÁ∫øÂõæ
                const renderMotoDioChart = () => {
                    if (!motoDioChartRef.value) return;
                    const ctx = motoDioChartRef.value.getContext('2d');
                    if (motoDioChartInstance) motoDioChartInstance.destroy();

                    let chartData = motoDioData.value;
                    if (selectedMotoDioStartMonth.value || selectedMotoDioEndMonth.value) {
                        chartData = motoDioData.value.filter(item => {
                            const itemMonth = item.year_month;
                            const startOk = !selectedMotoDioStartMonth.value || itemMonth >= selectedMotoDioStartMonth.value;
                            const endOk = !selectedMotoDioEndMonth.value || itemMonth <= selectedMotoDioEndMonth.value;
                            return startOk && endOk;
                        });
                    }

                    const validData = chartData.filter(item => item.dio !== null && item.dio !== undefined);
                    motoDioChartInstance = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: validData.map(item => item.year_month),
                            datasets: [{
                                label: 'DIO (Days)',
                                data: validData.map(item => item.dio),
                                borderColor: 'rgba(138,43,226, 1)',
                                backgroundColor: 'rgba(138,43,226, 0.1)',
                                borderWidth: 2,
                                pointRadius: 4,
                                pointHoverRadius: 6,
                                tension: 0.3,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: true, position: 'top' },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const item = validData[context.dataIndex];
                                            return [
                                                `DIO: ${item.dio.toFixed(2)} days`,
                                                `Inventory: ${item.inventory_value.toLocaleString()}`,
                                                `12M Sales: ${item.sales_12m ? item.sales_12m.toLocaleString() : 'N/A'}`
                                            ];
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: { beginAtZero: true, title: { display: true, text: 'Days Inventory Outstanding' } },
                                x: { title: { display: true, text: 'Month' } }
                            }
                        }
                    });
                };

                // Âä†ËΩΩ Fluid DIO Êï∞ÊçÆ
                const loadFluidDioData = async () => {
                    try {
                        const response = await fetch(`${API_BASE}/data/fluid/dio`);
                        const data = await response.json();
                        fluidDioData.value = data;
                        fluidDioMonths.value = data.map(item => item.year_month);
                        // Áî® DIO Êï∞ÊçÆÂ°´ÂÖÖ Fluid ÊØèÊúàÂáÄÈîÄÂîÆÈ¢ù
                        const fluidNetSalesDict = {};
                        data.forEach(item => {
                            if (item.year_month && item.net_sales_month !== undefined) {
                                fluidNetSalesDict[item.year_month] = item.net_sales_month;
                            }
                        });
                        fluidMonthlyNetSales.value = fluidNetSalesDict;
                        console.log('Fluid DIO data loaded:', data.length, 'months');
                    } catch (e) {
                        console.error('Error loading Fluid DIO data:', e);
                        fluidDioData.value = [];
                        fluidDioMonths.value = [];
                        fluidMonthlyNetSales.value = {};
                    }
                };

                // Ê∏≤Êüì Fluid DIO ÊäòÁ∫øÂõæ
                const renderFluidDioChart = () => {
                    if (!fluidDioChartRef.value) return;
                    const ctx = fluidDioChartRef.value.getContext('2d');
                    if (fluidDioChartInstance) fluidDioChartInstance.destroy();

                    let chartData = fluidDioData.value;
                    if (selectedFluidDioStartMonth.value || selectedFluidDioEndMonth.value) {
                        chartData = fluidDioData.value.filter(item => {
                            const itemMonth = item.year_month;
                            const startOk = !selectedFluidDioStartMonth.value || itemMonth >= selectedFluidDioStartMonth.value;
                            const endOk = !selectedFluidDioEndMonth.value || itemMonth <= selectedFluidDioEndMonth.value;
                            return startOk && endOk;
                        });
                    }

                    const validData = chartData.filter(item => item.dio !== null && item.dio !== undefined);
                    fluidDioChartInstance = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: validData.map(item => item.year_month),
                            datasets: [{
                                label: 'DIO (Days)',
                                data: validData.map(item => item.dio),
                                borderColor: 'rgba(0,0,139, 1)',
                                backgroundColor: 'rgba(0,0,139, 0.1)',
                                borderWidth: 2,
                                pointRadius: 4,
                                pointHoverRadius: 6,
                                tension: 0.3,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: true, position: 'top' },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const item = validData[context.dataIndex];
                                            return [
                                                `DIO: ${item.dio.toFixed(2)} days`,
                                                `Inventory: ${item.inventory_value.toLocaleString()}`,
                                                `12M Sales: ${item.sales_12m ? item.sales_12m.toLocaleString() : 'N/A'}`
                                            ];
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: { beginAtZero: true, title: { display: true, text: 'Days Inventory Outstanding' } },
                                x: { title: { display: true, text: 'Month' } }
                            }
                        }
                    });
                };
                
                // ËÆ°ÁÆóÁªÑÂêàÂõæË°®ÁöÑÊâÄÊúâÊúà‰ªΩ
                const combinedDioMonths = computed(() => {
                    const allMonths = new Set();
                    if (Array.isArray(dioMonths.value)) {
                        dioMonths.value.forEach(m => allMonths.add(m));
                    }
                    if (Array.isArray(padsDioMonths.value)) {
                        padsDioMonths.value.forEach(m => allMonths.add(m));
                    }
                    if (Array.isArray(motoDioMonths.value)) {
                        motoDioMonths.value.forEach(m => allMonths.add(m));
                    }
                    if (Array.isArray(fluidDioMonths.value)) {
                        fluidDioMonths.value.forEach(m => allMonths.add(m));
                    }
                    if (Array.isArray(totalDioMonths.value)) {
                        totalDioMonths.value.forEach(m => allMonths.add(m));
                    }
                    return Array.from(allMonths).sort();
                });

                const toggleDioCategory = (category) => {
                    Object.keys(dioVisibility.value).forEach(key => {
                        dioVisibility.value[key] = false;
                    });
                    dioVisibility.value[category] = true;
                    activeDioCategory.value = category;
                    nextTick(() => renderCombinedDioChart());
                };
                
                const loadTotalDioData = async () => {
                    try {
                        const response = await fetch(`${API_BASE}/data/total/dio`);
                        const data = await response.json();
                        totalDioData.value = data;
                        totalDioMonths.value = data.map(item => item.year_month);

                        const totalNetSalesDict = {};
                        data.forEach(item => {
                            if (item.year_month && item.net_sales_month !== undefined) {
                                totalNetSalesDict[item.year_month] = item.net_sales_month;
                            }
                        });
                        monthlyNetSales.value = totalNetSalesDict;
                        console.log('Total DIO data loaded:', data.length, 'months');
                    } catch (e) {
                        console.error('Error loading Total DIO data:', e);
                        totalDioData.value = [];
                        totalDioMonths.value = [];
                        monthlyNetSales.value = {};
                    }
                };
                // Ê∏≤Êüì DIO 
                const renderCombinedDioChart = () => {
                    if (!combinedDioChartRef.value) return;
                    const ctx = combinedDioChartRef.value.getContext('2d');
                    if (combinedDioChartInstance) combinedDioChartInstance.destroy();

                    const datasets = [];

                    if (dioVisibility.value.disc && dioData.value.length > 0) {
                        let discChartData = dioData.value;
                        if (selectedCombinedDioStartMonth.value || selectedCombinedDioEndMonth.value) {
                            discChartData = dioData.value.filter(item => {
                                const startOk = !selectedCombinedDioStartMonth.value || item.year_month >= selectedCombinedDioStartMonth.value;
                                const endOk = !selectedCombinedDioEndMonth.value || item.year_month <= selectedCombinedDioEndMonth.value;
                                return startOk && endOk;
                            });
                        }
                        const validDiscData = discChartData.filter(item => item.dio !== null && item.dio !== undefined);
                        if (validDiscData.length > 0) {
                            datasets.push({
                                label: 'Disc DIO',
                                data: validDiscData.map(item => ({ x: item.year_month, y: item.dio, raw: item })),
                                borderColor: 'rgba(52, 152, 219, 1)',
                                backgroundColor: 'rgba(52, 152, 219, 0.1)',
                                borderWidth: 2,
                                pointRadius: 4,
                                pointHoverRadius: 6,
                                tension: 0.1,
                                fill: false
                            });
                        }
                    }

                    if (dioVisibility.value.pads && padsDioData.value.length > 0) {
                        let padsChartData = padsDioData.value;
                        if (selectedCombinedDioStartMonth.value || selectedCombinedDioEndMonth.value) {
                            padsChartData = padsDioData.value.filter(item => {
                                const startOk = !selectedCombinedDioStartMonth.value || item.year_month >= selectedCombinedDioStartMonth.value;
                                const endOk = !selectedCombinedDioEndMonth.value || item.year_month <= selectedCombinedDioEndMonth.value;
                                return startOk && endOk;
                            });
                        }
                        const validPadsData = padsChartData.filter(item => item.dio !== null && item.dio !== undefined);
                        if (validPadsData.length > 0) {
                            datasets.push({
                                label: 'Pads DIO',
                                data: validPadsData.map(item => ({ x: item.year_month, y: item.dio, raw: item })),
                                borderColor: 'rgba(46, 204, 113, 1)',
                                backgroundColor: 'rgba(46, 204, 113, 0.1)',
                                borderWidth: 2,
                                pointRadius: 4,
                                pointHoverRadius: 6,
                                tension: 0.1,
                                fill: false
                            });
                        }
                    }

                    if (dioVisibility.value.moto && motoDioData.value.length > 0) {
                        let motoChartData = motoDioData.value;
                        if (selectedCombinedDioStartMonth.value || selectedCombinedDioEndMonth.value) {
                            motoChartData = motoDioData.value.filter(item => {
                                const startOk = !selectedCombinedDioStartMonth.value || item.year_month >= selectedCombinedDioStartMonth.value;
                                const endOk = !selectedCombinedDioEndMonth.value || item.year_month <= selectedCombinedDioEndMonth.value;
                                return startOk && endOk;
                            });
                        }
                        const validMotoData = motoChartData.filter(item => item.dio !== null && item.dio !== undefined);
                        if (validMotoData.length > 0) {
                            datasets.push({
                                label: 'Moto DIO',
                                data: validMotoData.map(item => ({ x: item.year_month, y: item.dio, raw: item })),
                                borderColor: 'rgba(155, 89, 182, 1)',
                                backgroundColor: 'rgba(155, 89, 182, 0.1)',
                                borderWidth: 2,
                                pointRadius: 4,
                                pointHoverRadius: 6,
                                tension: 0.1,
                                fill: false
                            });
                        }
                    }

                    if (dioVisibility.value.fluid && fluidDioData.value.length > 0) {
                        let fluidChartData = fluidDioData.value;
                        if (selectedCombinedDioStartMonth.value || selectedCombinedDioEndMonth.value) {
                            fluidChartData = fluidDioData.value.filter(item => {
                                const startOk = !selectedCombinedDioStartMonth.value || item.year_month >= selectedCombinedDioStartMonth.value;
                                const endOk = !selectedCombinedDioEndMonth.value || item.year_month <= selectedCombinedDioEndMonth.value;
                                return startOk && endOk;
                            });
                        }
                        const validFluidData = fluidChartData.filter(item => item.dio !== null && item.dio !== undefined);
                        if (validFluidData.length > 0) {
                            datasets.push({
                                label: 'Fluid DIO',
                                data: validFluidData.map(item => ({ x: item.year_month, y: item.dio, raw: item })),
                                borderColor: 'rgba(230, 126, 34, 1)',
                                backgroundColor: 'rgba(230, 126, 34, 0.1)',
                                borderWidth: 2,
                                pointRadius: 4,
                                pointHoverRadius: 6,
                                tension: 0.1,
                                fill: false
                            });
                        }
                    }
                    
                    if (dioVisibility.value.total && totalDioData.value.length > 0) {
                        let totalChartData = totalDioData.value;
                        if (selectedCombinedDioStartMonth.value || selectedCombinedDioEndMonth.value) {
                            totalChartData = totalDioData.value.filter(item => {
                                const startOk = !selectedCombinedDioStartMonth.value || item.year_month >= selectedCombinedDioStartMonth.value;
                                const endOk = !selectedCombinedDioEndMonth.value || item.year_month <= selectedCombinedDioEndMonth.value;
                                return startOk && endOk;
                            });
                        }
                        const validTotalData = totalChartData.filter(item => item.dio !== null && item.dio !== undefined);
                        if (validTotalData.length > 0) {
                            datasets.push({
                                label: 'Total DIO',
                                data: validTotalData.map(item => ({ x: item.year_month, y: item.dio, raw: item })),
                                borderColor: 'rgba(231, 76, 60, 1)',
                                backgroundColor: 'rgba(231, 76, 60, 0.1)',
                                borderWidth: 3,
                                pointRadius: 5,
                                pointHoverRadius: 7,
                                tension: 0.1,
                                fill: false,
                                yAxisID: 'y'
                            });
                        }
                    }
                    
                    let netSalesData = null;
                    let netSalesLabel = '';
                    let netSalesColor = '';
                    let inventoryData = null;
                    let inventoryLabel = '';
                    let inventoryColor = '';
                    let inventoryBorderColor = '';
                    
                    if (activeDioCategory.value === 'disc' && discMonthlyNetSales.value && Object.keys(discMonthlyNetSales.value).length > 0) {
                        netSalesData = discMonthlyNetSales.value;
                        netSalesLabel = 'Disc Net Sales';
                        netSalesColor = 'rgba(52, 152, 219, 0.3)';
                        inventoryData = dioData.value;
                        inventoryLabel = 'Disc Inventory Value';
                        inventoryColor = 'rgba(52, 152, 219, 0.2)';
                        inventoryBorderColor = 'rgba(52, 152, 219, 0.8)';
                    } else if (activeDioCategory.value === 'pads' && padsMonthlyNetSales.value && Object.keys(padsMonthlyNetSales.value).length > 0) {
                        netSalesData = padsMonthlyNetSales.value;
                        netSalesLabel = 'Pads Net Sales';
                        netSalesColor = 'rgba(46, 204, 113, 0.3)';
                        inventoryData = padsDioData.value;
                        inventoryLabel = 'Pads Inventory Value';
                        inventoryColor = 'rgba(46, 204, 113, 0.2)';
                        inventoryBorderColor = 'rgba(46, 204, 113, 0.8)';
                    } else if (activeDioCategory.value === 'moto' && motoMonthlyNetSales.value && Object.keys(motoMonthlyNetSales.value).length > 0) {
                        netSalesData = motoMonthlyNetSales.value;
                        netSalesLabel = 'Moto Net Sales';
                        netSalesColor = 'rgba(155, 89, 182, 0.3)';
                        inventoryData = motoDioData.value;
                        inventoryLabel = 'Moto Inventory Value';
                        inventoryColor = 'rgba(155, 89, 182, 0.2)';
                        inventoryBorderColor = 'rgba(155, 89, 182, 0.8)';
                    } else if (activeDioCategory.value === 'fluid' && fluidMonthlyNetSales.value && Object.keys(fluidMonthlyNetSales.value).length > 0) {
                        netSalesData = fluidMonthlyNetSales.value;
                        netSalesLabel = 'Fluid Net Sales';
                        netSalesColor = 'rgba(189, 183, 107, 0.3)';
                        inventoryData = fluidDioData.value;
                        inventoryLabel = 'Fluid Inventory Value';
                        inventoryColor = 'rgba(240, 230, 140, 0.2)';
                        inventoryBorderColor = 'rgba(240, 230, 140, 0.8)';
                    } else if (activeDioCategory.value === 'total' && monthlyNetSales.value && Object.keys(monthlyNetSales.value).length > 0) {
                        netSalesData = monthlyNetSales.value;
                        netSalesLabel = 'Total Net Sales';
                        netSalesColor = 'rgba(220, 60, 60, 0.3)';
                        inventoryData = totalDioData.value;
                        inventoryLabel = 'Total Inventory Value';
                        inventoryColor = 'rgba(240, 128, 128, 0.2)';
                        inventoryBorderColor = 'rgba(240, 128, 128, 0.8)';
                    }
                    
                    if (netSalesData) {
                        let salesData = Object.entries(netSalesData).map(([month, value]) => ({
                            x: month,
                            y: value
                        }));
                        
                        // ÊåâÊó•ÊúüËåÉÂõ¥ËøáÊª§
                        if (selectedCombinedDioStartMonth.value || selectedCombinedDioEndMonth.value) {
                            salesData = salesData.filter(item => {
                                const startOk = !selectedCombinedDioStartMonth.value || item.x >= selectedCombinedDioStartMonth.value;
                                const endOk = !selectedCombinedDioEndMonth.value || item.x <= selectedCombinedDioEndMonth.value;
                                return startOk && endOk;
                            });
                        }
                        
                        datasets.push({
                            type: 'bar',
                            label: netSalesLabel,
                            data: salesData,
                            backgroundColor: netSalesColor,
                            borderColor: netSalesColor.replace('0.3', '0.8'),
                            borderWidth: 1,
                            yAxisID: 'y1',
                            order: 2
                        });
                    }
                    
                    // Ê∑ªÂä†Â∫ìÂ≠ò‰ª∑ÂÄºÊäòÁ∫øÂõæ
                    if (inventoryData && inventoryData.length > 0) {
                        let invChartData = inventoryData;
                        
                        if (selectedCombinedDioStartMonth.value || selectedCombinedDioEndMonth.value) {
                            invChartData = inventoryData.filter(item => {
                                const startOk = !selectedCombinedDioStartMonth.value || item.year_month >= selectedCombinedDioStartMonth.value;
                                const endOk = !selectedCombinedDioEndMonth.value || item.year_month <= selectedCombinedDioEndMonth.value;
                                return startOk && endOk;
                            });
                        }
                        
                        const invData = invChartData.map(item => ({
                            x: item.year_month,
                            y: item.inventory_value
                        }));
                        
                        datasets.push({
                            type: 'line',
                            label: inventoryLabel,
                            data: invData,
                            borderColor: inventoryBorderColor,
                            backgroundColor: inventoryColor,
                            borderWidth: 2,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            tension: 0.3,
                            fill: false,
                            yAxisID: 'y',
                            order: 1
                        });
                    }

                    combinedDioChartInstance = new Chart(ctx, {
                        type: 'line',
                        data: { datasets },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                mode: 'index',
                                intersect: false
                            },
                            plugins: {
                                legend: { 
                                    display: true, 
                                    position: 'top',
                                    labels: {
                                        usePointStyle: true,
                                        padding: 15
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            if (context.dataset.label && context.dataset.label.includes('Net Sales')) {
                                                return `${context.dataset.label}: ‚Ç¨${context.parsed.y.toLocaleString()}`;
                                            }
                                            if (context.dataset.label && context.dataset.label.includes('Inventory Value')) {
                                                return `${context.dataset.label}: ‚Ç¨${context.parsed.y.toLocaleString()}`;
                                            }
                                            const dataPoint = context.raw.raw;
                                            if (dataPoint) {
                                                return [
                                                    `${context.dataset.label}: ${dataPoint.dio.toFixed(1)} days`,
                                                    `Inventory: ‚Ç¨${dataPoint.inventory_value.toLocaleString()}`,
                                                    `12M Sales: ‚Ç¨${dataPoint.sales_12m.toLocaleString()}`
                                                ];
                                            }
                                            return `${context.dataset.label}: ${context.parsed.y}`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    type: 'linear',
                                    position: 'left',
                                    beginAtZero: true,
                                    title: { display: true, text: 'Inventory Value (‚Ç¨)' }
                                },
                                y1: {
                                    type: 'linear',
                                    position: 'right',
                                    beginAtZero: true,
                                    title: { display: true, text: 'Net Sales (‚Ç¨)' },
                                    grid: {
                                        drawOnChartArea: false
                                    }
                                },
                                x: {
                                    type: 'category',
                                    title: { display: true, text: 'Month' }
                                }
                            }
                        }
                    });
                };
                
                const vueVersion = ref('3.3.4');
                
                // API Âü∫Á°ÄURL
                const API_BASE = 'http://localhost:3000/api';
                
                // Ê∑ªÂä†Á≠õÈÄâÁªÑ
                const addFilterGroup = () => {
                    const colorIndex = (filterGroups.value.length) % colorPalette.length;
                    filterGroups.value.push({
                        id: nextGroupId.value++,
                        name: `Group ${nextGroupId.value - 1}`,
                        color: colorPalette[colorIndex].bg,
                        borderColor: colorPalette[colorIndex].border,
                        filters: {
                            year: 'all',
                            month: 'all',
                            region: 'all',
                            country: 'all',
                            category: 'all',
                            customer: 'all',
                            itemGroup: 'all',
                            itemCode: 'all'
                        }
                    });
                };
                
                // Âà†Èô§Á≠õÈÄâÁªÑ
                const removeFilterGroup = (id) => {
                    if (filterGroups.value.length <= 1) {
                        showMessage('Ëá≥Â∞ëÈúÄË¶Å‰øùÁïô‰∏Ä‰∏™Á≠õÈÄâÁªÑ', 'error');
                        return;
                    }
                    filterGroups.value = filterGroups.value.filter(g => g.id !== id);
                    
                    // Âà†Èô§ÂêéÈáçÊñ∞Ê∏≤ÊüìÂõæË°®
                    nextTick(() => {
                        initCharts();
                        initCostBreakdownChart();
                    });
                };
                
                // ‰∏∫Êüê‰∏™Á≠õÈÄâÁªÑËøáÊª§Êï∞ÊçÆ
                const getFilteredDataForGroup = (groupFilters) => {
                    if (!salesData.value || salesData.value.length === 0) return [];
                    
                    return salesData.value.filter(item => {
                        if (viewMode.value === 'monthly' && groupFilters.year !== 'all') {
                            if (item.Year != groupFilters.year) {
                                return false;
                            }
                        }
                        
                        if (groupFilters.region !== 'all' && item.Region !== groupFilters.region) {
                            return false;
                        }
                        if (groupFilters.country !== 'all') {
                            const countryVal = item['Country'];
                            if (countryVal !== groupFilters.country) {
                                return false;
                            }
                        }
                        if (groupFilters.category !== 'all') {
                            const productType = item['Product Type'];
                            if (productType !== groupFilters.category) {
                                return false;
                            }
                        }
                        if (groupFilters.customer !== 'all') {
                            const customerName = item['Customer - Name'];
                            if (customerName !== groupFilters.customer) {
                                return false;
                            }
                        }
                        if (groupFilters.itemGroup !== 'all') {
                            const groupName = item['Item - Item Group Full Name'];
                            if (groupName !== groupFilters.itemGroup) {
                                return false;
                            }
                        }
                        if (groupFilters.itemCode !== 'all') {
                            const codeVal = item['Item - Code'];
                            if (codeVal !== groupFilters.itemCode) {
                                return false;
                            }
                        }
                        return true;
                    });
                };
                
                // ËÆ°ÁÆóÂ±ûÊÄß - Ê†πÊçÆÁ≠õÈÄâÊù°‰ª∂ËøáÊª§Êï∞ÊçÆÔºàÂÖºÂÆπÂéüÊúâÈÄªËæëÔºå‰ΩøÁî®Á¨¨‰∏ÄÁªÑÁ≠õÈÄâÔºâ
                const filteredSalesData = computed(() => {
                    if (filterGroups.value.length === 0) return [];
                    return getFilteredDataForGroup(filterGroups.value[0].filters);
                });
                
                // ËÆ°ÁÆóËøáÊª§ÂêéÁöÑÁªüËÆ°Êï∞ÊçÆ
                const filteredStats = computed(() => {
                    const data = filteredSalesData.value;
                    if (data.length === 0) {
                        return {
                            totalSales: 0,
                            salesQuantity: 0,
                            netSales: 0,
                            usdAmount: 0,
                            rmbAmount: 0
                        };
                    }
                    
                    return {
                        totalSales: data.reduce((sum, item) => sum + (Number(item['Total Sales Amt']) || 0), 0),
                        salesQuantity: data.reduce((sum, item) => sum + (Number(item['Sales Qua']) || 0), 0),
                        netSales: data.reduce((sum, item) => sum + (Number(item['Net Sales']) || 0), 0),
                        usdAmount: data.reduce((sum, item) => {
                            const totalSalesAmt = Number(item['Total Sales Amt']) || 0;
                            const usdRate = Number(item['USD_rate']) || 0;
                            return sum + (totalSalesAmt * usdRate);
                        }, 0),
                        rmbAmount: data.reduce((sum, item) => {
                            const totalSalesAmt = Number(item['Total Sales Amt']) || 0;
                            const rmbRate = Number(item['RMB_rate']) || 0;
                            return sum + (totalSalesAmt * rmbRate);
                        }, 0)
                    };
                });
                
                // ËÆ°ÁÆóËøáÊª§ÂêéÁöÑÊ±áÊÄªÊï∞ÊçÆ
                const filteredYearlySummary = computed(() => {
                    const data = filteredSalesData.value;
                    if (data.length === 0) return [];
                    
                    const summary = {};
                    data.forEach(item => {
                        const year = item.Year || item.year || item.YEAR;
                        if (!year) return;
                        
                        if (!summary[year]) {
                            summary[year] = {
                                year,
                                unitPriceTotal: 0,
                                unitPriceCount: 0,
                                salesQuantity: 0,
                                grossSalesAmount: 0,
                                ebit: 0
                            };
                        }
                        
                        if (item['Sales Amt per Unit']) {
                            summary[year].unitPriceTotal += Number(item['Sales Amt per Unit']) || 0;
                            summary[year].unitPriceCount += 1;
                        }
                        if (item['Sales Qua']) summary[year].salesQuantity += Number(item['Sales Qua']) || 0;
                        if (item['Total Sales Amt']) summary[year].grossSalesAmount += Number(item['Total Sales Amt']) || 0;
                        if (item['EBIT']) summary[year].ebit += Number(item['EBIT']) || 0;
                    });
                    
                    return Object.values(summary).map(item => ({
                        year: item.year,
                        unitPrice: item.unitPriceCount ? (item.unitPriceTotal / item.unitPriceCount) : 0,
                        salesQuantity: item.salesQuantity,
                        grossSalesAmount: item.grossSalesAmount,
                        ebit: item.ebit
                    })).sort((a, b) => a.year - b.year);
                });
                
                // ‰∏∫ÊüêÁªÑÁ≠õÈÄâÁîüÊàêÂπ¥Â∫¶Ê±áÊÄª
                const getYearlySummaryForGroup = (data) => {
                    if (data.length === 0) return [];
                    
                    const summary = {};
                    data.forEach(item => {
                        const year = item.Year || item.year || item.YEAR;
                        if (!year) return;
                        
                        if (!summary[year]) {
                            summary[year] = {
                                year,
                                unitPriceTotal: 0,
                                unitPriceCount: 0,
                                salesQuantity: 0,
                                grossSalesAmount: 0,
                                ebit: 0
                            };
                        }
                        
                        if (item['Sales Amt per Unit']) {
                            summary[year].unitPriceTotal += Number(item['Sales Amt per Unit']) || 0;
                            summary[year].unitPriceCount += 1;
                        }
                        if (item['Sales Qua']) summary[year].salesQuantity += Number(item['Sales Qua']) || 0;
                        if (item['Total Sales Amt']) summary[year].grossSalesAmount += Number(item['Total Sales Amt']) || 0;
                        if (item['EBIT']) summary[year].ebit += Number(item['EBIT']) || 0;
                    });
                    
                    return Object.values(summary).map(item => ({
                        year: item.year,
                        unitPrice: item.unitPriceCount ? (item.unitPriceTotal / item.unitPriceCount) : 0,
                        salesQuantity: item.salesQuantity,
                        grossSalesAmount: item.grossSalesAmount,
                        ebit: item.ebit
                    })).sort((a, b) => a.year - b.year);
                };
                
                // ËÆ°ÁÆóËøáÊª§ÂêéÁöÑÊúàÂ∫¶Ê±áÊÄªÊï∞ÊçÆ
                const filteredMonthlySummary = computed(() => {
                    const data = filteredSalesData.value;
                    if (data.length === 0) return [];
                    
                    const summary = {};
                    data.forEach(item => {
                        let month = item.Month || item.month;
                        
                        // Â¶ÇÊûúÊ≤°ÊúâMonthÂ≠óÊÆµ,Â∞ùËØï‰ªéDateÂ≠óÊÆµÊèêÂèñ
                        if (!month && item.Date) {
                            const date = new Date(item.Date);
                            if (!isNaN(date.getTime())) {
                                month = date.getMonth() + 1;
                            }
                        }
                        
                        if (!month) return;
                        
                        if (!summary[month]) {
                            summary[month] = {
                                month: Number(month),
                                unitPriceTotal: 0,
                                unitPriceCount: 0,
                                salesQuantity: 0,
                                grossSalesAmount: 0,
                                ebit: 0
                            };
                        }
                        
                        if (item['Sales Amt per Unit']) {
                            summary[month].unitPriceTotal += Number(item['Sales Amt per Unit']) || 0;
                            summary[month].unitPriceCount += 1;
                        }
                        if (item['Sales Qua']) summary[month].salesQuantity += Number(item['Sales Qua']) || 0;
                        if (item['Total Sales Amt']) summary[month].grossSalesAmount += Number(item['Total Sales Amt']) || 0;
                        if (item['EBIT']) summary[month].ebit += Number(item['EBIT']) || 0;
                    });
                    
                    return Object.values(summary).map(item => ({
                        month: item.month,
                        unitPrice: item.unitPriceCount ? (item.unitPriceTotal / item.unitPriceCount) : 0,
                        salesQuantity: item.salesQuantity,
                        grossSalesAmount: item.grossSalesAmount,
                        ebit: item.ebit
                    })).sort((a, b) => a.month - b.month);
                });
                
                // ‰∏∫ÊüêÁªÑÁ≠õÈÄâÁîüÊàêÊúàÂ∫¶Ê±áÊÄª
                const getMonthlySummaryForGroup = (data) => {
                    if (data.length === 0) return [];
                    
                    const summary = {};
                    data.forEach(item => {
                        let month = item.Month || item.month;
                        
                        if (!month && item.Date) {
                            const date = new Date(item.Date);
                            if (!isNaN(date.getTime())) {
                                month = date.getMonth() + 1;
                            }
                        }
                        
                        if (!month) return;
                        
                        if (!summary[month]) {
                            summary[month] = {
                                month: Number(month),
                                unitPriceTotal: 0,
                                unitPriceCount: 0,
                                salesQuantity: 0,
                                grossSalesAmount: 0,
                                ebit: 0
                            };
                        }
                        
                        if (item['Sales Amt per Unit']) {
                            summary[month].unitPriceTotal += Number(item['Sales Amt per Unit']) || 0;
                            summary[month].unitPriceCount += 1;
                        }
                        if (item['Sales Qua']) summary[month].salesQuantity += Number(item['Sales Qua']) || 0;
                        if (item['Total Sales Amt']) summary[month].grossSalesAmount += Number(item['Total Sales Amt']) || 0;
                        if (item['EBIT']) summary[month].ebit += Number(item['EBIT']) || 0;
                    });
                    
                    return Object.values(summary).map(item => ({
                        month: item.month,
                        unitPrice: item.unitPriceCount ? (item.unitPriceTotal / item.unitPriceCount) : 0,
                        salesQuantity: item.salesQuantity,
                        grossSalesAmount: item.grossSalesAmount,
                        ebit: item.ebit
                    })).sort((a, b) => a.month - b.month);
                };
                
                // ÊñπÊ≥ï
                const formatNumber = (num) => {
                    if (!num) return '0';
                    // ËΩ¨Êç¢‰∏∫Êï¥Êï∞Âπ∂Ê∑ªÂä†ÂçÉ‰ΩçÂàÜÈöîÁ¨¶
                    return Math.round(num).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                };
                
                const showMessage = (text, type = 'success') => {
                    message.value = text;
                    messageType.value = type;
                    setTimeout(() => {
                        message.value = '';
                    }, 5000);
                };

                // ÂÆ¢Êà∑ÈÄâÈ°π
                const customerOptions = computed(() => {
                    if (!salesData.value || salesData.value.length === 0) return [];
                    const set = new Set();
                    salesData.value.forEach(row => {
                        const val = row['Customer - Name'];
                        if (val) set.add(val);
                    });
                    return Array.from(set).sort();
                });

                // Country ÈÄâÈ°π
                const countryOptions = computed(() => {
                    if (!salesData.value || salesData.value.length === 0) return [];
                    const set = new Set();
                    salesData.value.forEach(row => {
                        const val = row['Country'];
                        if (val) set.add(val);
                    });
                    return Array.from(set).sort();
                });

                // Item Group ÈÄâÈ°π
                const itemGroupOptions = computed(() => {
                    if (!salesData.value || salesData.value.length === 0) return [];
                    const set = new Set();
                    salesData.value.forEach(row => {
                        const val = row['Item - Item Group Full Name'];
                        if (val) set.add(val);
                    });
                    return Array.from(set).sort();
                });

                // Item Code ÈÄâÈ°π
                const itemCodeOptions = computed(() => {
                    if (!salesData.value || salesData.value.length === 0) return [];
                    const set = new Set();
                    salesData.value.forEach(row => {
                        const val = row['Item - Code'];
                        if (val) set.add(val);
                    });
                    return Array.from(set).sort();
                });
                // Ê†πÊçÆÊêúÁ¥¢ÂÖ≥ÈîÆÂ≠óËøáÊª§ÂêéÁöÑ Item Code ÂàóË°®
                const filteredItemCodeOptions = computed(() => {
                    const all = itemCodeOptions.value;
                    const kw = itemCodeSearch.value.trim().toLowerCase();
                    if (!kw) return all;
                    return all.filter(code => String(code).toLowerCase().includes(kw));
                });

                // ËøáÊª§ÂêéÁöÑÊàêÊú¨ÂàÜËß£ (‰∏éÁ≠õÈÄâËÅîÂä®)
                const filteredCostBreakdown = computed(() => {
                    const data = filteredSalesData.value;
                    if (!data || data.length === 0) return [];
                    const netSalesAmt = data.reduce((sum, item) => sum + (Number(item['Net Sales']) || 0), 0);
                    const costMapping = {
                        'Rebate': 'Rebate Amount',
                        'Freight Out': 'Freight Out',
                        'Purchasing Material': 'Act Material Cost Total',
                        'Warehouse Operation': 'Contracted Work Total',
                        'Commission': 'Commission',
                        'Other SG&A': 'SG&A Total Exclud. Commission',
                        'EBIT': 'EBIT'
                    };
                    return Object.entries(costMapping).map(([category, columnName]) => {
                        const total = data.reduce((sum, item) => sum + (Number(item[columnName]) || 0), 0);
                        const percentage = netSalesAmt > 0 ? (total / netSalesAmt) * 100 : 0;
                        return { category, value: total, percentage };
                    }).filter(item => item.value !== 0 || item.percentage !== 0);
                });
                
                // Balance Áõ∏ÂÖ≥ËÆ°ÁÆóÂ±ûÊÄß - ‰ªÖ‰ªé Balance Overall Ëé∑ÂèñÊúà‰ªΩ
                const balanceMonthOptions = computed(() => {
                    const allMonths = new Set();
                    
                    // ‰ªé Balance Êñá‰ª∂Ëé∑ÂèñÊúà‰ªΩ
                    if (balanceOverview.value.overall && balanceOverview.value.overall.length > 0) {
                        balanceOverview.value.overall.forEach(item => {
                            if (item.month) allMonths.add(item.month);
                        });
                    }
                    
                    // ‰ªé Disc„ÄÅPads„ÄÅMoto„ÄÅFluid Êñá‰ª∂Ëé∑ÂèñÊúà‰ªΩ
                    discMonths.value.forEach(m => allMonths.add(m));
                    padsMonths.value.forEach(m => allMonths.add(m));
                    motoMonths.value.forEach(m => allMonths.add(m));
                    fluidMonths.value.forEach(m => allMonths.add(m));
                    
                    return Array.from(allMonths).sort();
                });
                
                const selectedBalanceData = computed(() => {
                    if (!selectedBalanceMonth.value || !balanceOverview.value.overall) return null;
                    
                    const overallItem = balanceOverview.value.overall.find(item => item.month === selectedBalanceMonth.value);
                    const transitItem = balanceOverview.value.goodsInTransit.find(item => item.month === selectedBalanceMonth.value);
                    
                    if (!overallItem && !transitItem) return null;
                    
                    return {
                        overall: overallItem ? overallItem.value : 0,
                        goodsInTransit: transitItem ? transitItem.value : 0
                    };
                });
                
                const latestOverall = computed(() => {
                    if (balanceOverview.value.overall.length === 0) return 0;
                    const latest = balanceOverview.value.overall[balanceOverview.value.overall.length - 1];
                    return latest.value || 0;
                });
                
                const latestGoodsInTransit = computed(() => {
                    if (balanceOverview.value.goodsInTransit.length === 0) return 0;
                    const latest = balanceOverview.value.goodsInTransit[balanceOverview.value.goodsInTransit.length - 1];
                    return latest.value || 0;
                });
                
                // Disc
                const discStatsAll = computed(() => {
                    if (!discAllData.value || discAllData.value.length === 0) {
                        return { value: 0, qty: 0 };
                    }
                    const value = discAllData.value.reduce((sum, item) => sum + (Number(item['Inventory value']) || 0), 0);
                    const qty = discAllData.value.reduce((sum, item) => sum + (Number(item['On-hand']) || 0), 0);
                    return { value, qty };
                });
                
                // Pads
                const padsStatsAll = computed(() => {
                    if (!padsAllData.value || padsAllData.value.length === 0) {
                        return { value: 0, qty: 0 };
                    }
                    const value = padsAllData.value.reduce((sum, item) => sum + (Number(item['Inventory value']) || 0), 0);
                    const qty = padsAllData.value.reduce((sum, item) => sum + (Number(item['On-hand']) || 0), 0);
                    return { value, qty };
                });
                
                // Moto
                const motoStatsAll = computed(() => {
                    if (!motoAllData.value || motoAllData.value.length === 0) {
                        return { value: 0, qty: 0 };
                    }
                    const value = motoAllData.value.reduce((sum, item) => sum + (Number(item['Inventory value']) || 0), 0);
                    const qty = motoAllData.value.reduce((sum, item) => sum + (Number(item['On-hand']) || 0), 0);
                    return { value, qty };
                });
                
                // Fluid
                const fluidStatsAll = computed(() => {
                    if (!fluidAllData.value || fluidAllData.value.length === 0) {
                        return { value: 0, qty: 0 };
                    }
                    const value = fluidAllData.value.reduce((sum, item) => sum + (Number(item['Inventory value']) || 0), 0);
                    const qty = fluidAllData.value.reduce((sum, item) => sum + (Number(item['On-hand']) || 0), 0);
                    return { value, qty };
                });
                
                // Category 
                const categoryMonthOptions = computed(() => {
                    const months = new Set();
                    if (discMonths.value.length > 0) {
                        discMonths.value.forEach(month => months.add(month));
                    }
                    if (padsMonths.value.length > 0) {
                        padsMonths.value.forEach(month => months.add(month));
                    }
                    if (motoMonths.value.length > 0) {
                        motoMonths.value.forEach(month => months.add(month));
                    }
                    if (fluidMonths.value.length > 0) {
                        fluidMonths.value.forEach(month => months.add(month));
                    }
                    return Array.from(months).sort();
                });
                
                const discStatsByMonth = computed(() => {
                    if (!selectedCategoryMonth.value || !discAllData.value || discAllData.value.length === 0) {
                        return { value: 0, qty: 0 };
                    }
                    const filtered = discAllData.value.filter(item => item.year_month === selectedCategoryMonth.value);
                    const value = filtered.reduce((sum, item) => sum + (Number(item['Inventory value']) || 0), 0);
                    const qty = filtered.reduce((sum, item) => sum + (Number(item['On-hand']) || 0), 0);
                    return { value, qty };
                });
         
                const padsStatsByMonth = computed(() => {
                    if (!selectedCategoryMonth.value || !padsAllData.value || padsAllData.value.length === 0) {
                        return { value: 0, qty: 0 };
                    }
                    const filtered = padsAllData.value.filter(item => item.year_month === selectedCategoryMonth.value);
                    const value = filtered.reduce((sum, item) => sum + (Number(item['Inventory value']) || 0), 0);
                    const qty = filtered.reduce((sum, item) => sum + (Number(item['On-hand']) || 0), 0);
                    return { value, qty };
                });
                
                const motoStatsByMonth = computed(() => {
                    if (!selectedCategoryMonth.value || !motoAllData.value || motoAllData.value.length === 0) {
                        return { value: 0, qty: 0 };
                    }
                    const filtered = motoAllData.value.filter(item => item.year_month === selectedCategoryMonth.value);
                    const value = filtered.reduce((sum, item) => sum + (Number(item['Inventory value']) || 0), 0);
                    const qty = filtered.reduce((sum, item) => sum + (Number(item['On-hand']) || 0), 0);
                    return { value, qty };
                });

                const fluidStatsByMonth = computed(() => {
                    if (!selectedCategoryMonth.value || !fluidAllData.value || fluidAllData.value.length === 0) {
                        return { value: 0, qty: 0 };
                    }
                    const filtered = fluidAllData.value.filter(item => item.year_month === selectedCategoryMonth.value);
                    const value = filtered.reduce((sum, item) => sum + (Number(item['Inventory value']) || 0), 0);
                    const qty = filtered.reduce((sum, item) => sum + (Number(item['On-hand']) || 0), 0);
                    return { value, qty };
                });
                
                const triggerFileInput = () => {
                    fileInput.value.click();
                };
                
                const onFileSelect = (event) => {
                    const files = Array.from(event.target.files);
                    if (files.length > 0) {
                        selectedFiles.value = files;
                    }
                };
                
                const onDrop = (event) => {
                    event.preventDefault();
                    isDragover.value = false;
                    
                    const files = Array.from(event.dataTransfer.files);
                    if (files.length > 0) {
                        selectedFiles.value = files;
                    }
                };
                
                const uploadFile = async () => {
                    if (selectedFiles.value.length === 0) {
                        showMessage('ËØ∑ÂÖàÈÄâÊã©Êñá‰ª∂', 'error');
                        return;
                    }
                    
                    const MAX_UPLOAD_MB = 50; 
                    
                    for (let file of selectedFiles.value) {
                        if (file.size > MAX_UPLOAD_MB * 1024 * 1024) {
                            showMessage(`Êñá‰ª∂ ${file.name} Â§™Â§ßÔºåÊúÄÂ§ßÂÖÅËÆ∏ ${MAX_UPLOAD_MB} MB`, 'error');
                            return;
                        }
                    }
                    
                    isUploading.value = true;
                    
                    try {
                        const formData = new FormData();
                        // Ê∑ªÂä†ÊâÄÊúâÈÄâ‰∏≠ÁöÑÊñá‰ª∂
                        selectedFiles.value.forEach(file => {
                            formData.append('excelFiles', file);
                        });
                    
                        const response = await fetch(`${API_BASE}/upload`, {
                            method: 'POST',
                            body: formData
                        });

                        // ÂÖàÊääÂìçÂ∫îËØªÂèñ‰∏∫ÊñáÊú¨ ‚Äî Â¶ÇÊûúËøîÂõûÁöÑÊòØ JSONÔºåÂàô‰∏ãÈù¢‰ºöËß£ÊûêÊàêÂäüÔºõ
                        // Â¶ÇÊûúËøîÂõû HTMLÔºà‰æãÂ¶ÇÈîôËØØÈ°µÈù¢ÔºâÔºåÊàë‰ª¨‰πüËÉΩÊääÊñáÊú¨ÊòæÁ§∫ÁªôÁî®Êà∑ÔºåÈÅøÂÖç `Unexpected token '<'` ÈîôËØØ„ÄÇ
                        const text = await response.text();
                        let result = null;
                        try {
                            result = JSON.parse(text);
                        } catch (e) {
                            // Èùû JSON ÂìçÂ∫îÔºàÂ¶Ç HTMLÔºâÔºåÊääÂéüÊñá‰Ωú‰∏∫ÈîôËØØ‰ø°ÊÅØÂ±ïÁ§∫
                            result = { error: text };
                        }

                        if (response.ok) {
                            const fileCount = result.filesUploaded || selectedFiles.value.length;
                            showMessage(`ÊàêÂäü‰∏ä‰º† ${fileCount} ‰∏™Êñá‰ª∂! Êñ∞Â¢û ${result.newRecords} Êù°ËÆ∞ÂΩïÔºåÊÄªËÆ° ${result.totalRecords} Êù°`);
                            totalRecords.value = result.totalRecords || 0;
                            // ÈáçÊñ∞Âä†ËΩΩÊï∞ÊçÆ
                            await loadData();
                            // Ê∏ÖÁ©∫Êñá‰ª∂ÈÄâÊã©,ÂÖÅËÆ∏ÁªßÁª≠‰∏ä‰º†
                            selectedFiles.value = [];
                            if (fileInput.value) {
                                fileInput.value.value = '';
                            }
                        } else {
                            const errMsg = result && result.error ? result.error : 'Êú™Áü•ÈîôËØØ';
                            showMessage('‰∏ä‰º†Â§±Ë¥•: ' + errMsg, 'error');
                        }
                    } catch (error) {
                        showMessage('‰∏ä‰º†Â§±Ë¥•: ' + error.message, 'error');
                    } finally {
                        isUploading.value = false;
                    }
                };
                
                const loadSampleData = async () => {
                    try {
                        await loadData();
                        showMessage('Á§∫‰æãÊï∞ÊçÆÂä†ËΩΩÊàêÂäüÔºÅ');
                    } catch (error) {
                        showMessage('Âä†ËΩΩÁ§∫‰æãÊï∞ÊçÆÂ§±Ë¥•: ' + error.message, 'error');
                    }
                };
                
                const clearData = async () => {
                    if (!confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÊï∞ÊçÆÂêó?')) {
                        return;
                    }
                    try {
                        const response = await fetch(`${API_BASE}/clear`, {
                            method: 'POST'
                        });
                        if (response.ok) {
                            showMessage('Êï∞ÊçÆÂ∑≤Ê∏ÖÁ©∫');
                            totalRecords.value = 0;
                            // Ê∏ÖÁ©∫ÂâçÁ´ØÊï∞ÊçÆ
                            salesData.value = [];
                            productData.value = [];
                            regionData.value = [];
                            yearData.value = [];
                            yearlySummaryData.value = [];
                            costBreakdownData.value = [];
                            monthlyNetSales.value = {};
                            discMonthlyNetSales.value = {};
                            padsMonthlyNetSales.value = {};
                            motoMonthlyNetSales.value = {};
                            fluidMonthlyNetSales.value = {};
                            stats.value = {
                                totalSales: 0,
                                salesQuantity: 0,
                                netSales: 0,
                                usdAmount: 0,
                                rmbAmount: 0
                            };
                            // ÈîÄÊØÅÂõæË°®
                            if (charts.value.unitPrice) charts.value.unitPrice.destroy();
                            if (charts.value.salesQuantity) charts.value.salesQuantity.destroy();
                            if (charts.value.grossSales) charts.value.grossSales.destroy();
                            if (charts.value.ebit) charts.value.ebit.destroy();
                            if (charts.value.costBreakdownCharts) {
                                charts.value.costBreakdownCharts.forEach(chart => {
                                    if (chart) chart.destroy();
                                });
                            }
                            charts.value = {};
                        } else {
                            showMessage('Ê∏ÖÁ©∫Êï∞ÊçÆÂ§±Ë¥•', 'error');
                        }
                    } catch (error) {
                        showMessage('Ê∏ÖÁ©∫Êï∞ÊçÆÂ§±Ë¥•: ' + error.message, 'error');
                    }
                };
                
                const loadData = async () => {
                    try {
                        // Ëé∑ÂèñÈîÄÂîÆÊï∞ÊçÆÔºàÊîØÊåÅÂàÜÈ°µÔºâ
                        const salesResponse = await fetch(`${API_BASE}/data/sales?limit=5000&offset=0`);
                        if (salesResponse.ok) {
                            const salesResult = await salesResponse.json();
                            // Â§ÑÁêÜÂàÜÈ°µÂìçÂ∫îÊ†ºÂºè {totalRecords, offset, limit, data}
                            if (salesResult.data && Array.isArray(salesResult.data)) {
                                salesData.value = salesResult.data;
                                console.log('ÈîÄÂîÆÊï∞ÊçÆ:', salesResult.data.length, 'Êù° (ÊÄªËÆ°:', salesResult.totalRecords, ')');
                            } else if (Array.isArray(salesResult)) {
                                // ÂÖºÂÆπÊóßÊ†ºÂºèÔºàÁõ¥Êé•ËøîÂõûÊï∞ÁªÑÔºâ
                                salesData.value = salesResult;
                                console.log('ÈîÄÂîÆÊï∞ÊçÆ:', salesResult.length, 'Êù°');
                            } else {
                                salesData.value = [];
                                console.log('ÈîÄÂîÆÊï∞ÊçÆÊ†ºÂºèÂºÇÂ∏∏');
                            }
                        } else {
                            console.error('Ëé∑ÂèñÈîÄÂîÆÊï∞ÊçÆÂ§±Ë¥•:', await salesResponse.text());
                            salesData.value = [];
                        }

                        // Ëé∑Âèñ‰∫ßÂìÅÊï∞ÊçÆ
                        const productsResponse = await fetch(`${API_BASE}/data/products`);
                        if (productsResponse.ok) {
                            productData.value = await productsResponse.json();
                            console.log('‰∫ßÂìÅÊï∞ÊçÆ:', productData.value.length, 'Êù°');
                        } else {
                            console.error('Ëé∑Âèñ‰∫ßÂìÅÊï∞ÊçÆÂ§±Ë¥•:', await productsResponse.text());
                            productData.value = [];
                        }

                        // Ëé∑ÂèñÂú∞Âå∫Êï∞ÊçÆ
                        const regionsResponse = await fetch(`${API_BASE}/data/regions`);
                        if (regionsResponse.ok) {
                            regionData.value = await regionsResponse.json();
                            console.log('Âú∞Âå∫Êï∞ÊçÆ:', regionData.value.length, 'Êù°');
                        } else {
                            console.error('Ëé∑ÂèñÂú∞Âå∫Êï∞ÊçÆÂ§±Ë¥•:', await regionsResponse.text());
                            regionData.value = [];
                        }

                        // Ëé∑ÂèñÂπ¥‰ªΩÊï∞ÊçÆ
                        const yearResponse = await fetch(`${API_BASE}/data/year`);
                        if (yearResponse.ok) {
                            yearData.value = await yearResponse.json();
                            console.log('Âπ¥‰ªΩÊï∞ÊçÆ:', yearData.value.length, 'Êù°');
                        } else {
                            console.error('Ëé∑ÂèñÂπ¥‰ªΩÊï∞ÊçÆÂ§±Ë¥•:', await yearResponse.text());
                            yearData.value = [];
                        }

                        // Ëé∑ÂèñÊ±áÊÄªÊï∞ÊçÆ
                        const yearlySummaryResponse = await fetch(`${API_BASE}/data/yearly-summary`);
                        if (yearlySummaryResponse.ok) {
                            yearlySummaryData.value = await yearlySummaryResponse.json();
                            console.log('Ê±áÊÄªÊï∞ÊçÆ:', yearlySummaryData.value);
                            console.log('Ê±áÊÄªÊï∞ÊçÆÈïøÂ∫¶:', yearlySummaryData.value.length);
                            console.log('Ê±áÊÄªÊï∞ÊçÆËØ¶ÁªÜ:', JSON.stringify(yearlySummaryData.value, null, 2));
                        } else {
                            console.error('Ëé∑ÂèñÊ±áÊÄªÊï∞ÊçÆÂ§±Ë¥•:', await yearlySummaryResponse.text());
                            yearlySummaryData.value = [];
                        }

                        // Ëé∑ÂèñÁªüËÆ°Êï∞ÊçÆ
                        const statsResponse = await fetch(`${API_BASE}/stats`);
                        if (statsResponse.ok) {
                            stats.value = await statsResponse.json();
                            console.log('ÁªüËÆ°Êï∞ÊçÆ:', stats.value);
                        } else {
                            console.error('Ëé∑ÂèñÁªüËÆ°Êï∞ÊçÆÂ§±Ë¥•:', await statsResponse.text());
                            stats.value = { totalSales: 0 };
                        }
                        
                        // Ëé∑ÂèñÊàêÊú¨ÂàÜËß£Êï∞ÊçÆ
                        const costBreakdownResponse = await fetch(`${API_BASE}/data/cost-breakdown`);
                        if (costBreakdownResponse.ok) {
                            costBreakdownData.value = await costBreakdownResponse.json();
                            console.log('ÊàêÊú¨ÂàÜËß£Êï∞ÊçÆ:', costBreakdownData.value);
                        } else {
                            console.error('Ëé∑ÂèñÊàêÊú¨ÂàÜËß£Êï∞ÊçÆÂ§±Ë¥•:', await costBreakdownResponse.text());
                            costBreakdownData.value = [];
                        }
                        
                        // Ê≥®ÊÑèÔºöÊØèÊúàÂáÄÈîÄÂîÆÈ¢ùÂ∑≤ÁªèÂú®ÂêÑ‰∏™ loadXxxDioData() ÂáΩÊï∞‰∏≠‰ªé DIO Êé•Âè£ÁöÑ net_sales_month Â≠óÊÆµËé∑Âèñ
                        // ‰∏çÂÜçÈúÄË¶Å‰ªé salesData ÈáçÊñ∞ËÆ°ÁÆóÔºå‰ª•ÈÅøÂÖçË¶ÜÁõñÂêéÁ´ØËÆ°ÁÆóÁöÑÊ≠£Á°ÆÂÄº

                        // ÈáçÊñ∞Ê∏≤ÊüìÂõæË°®
                        initCharts();
                        initCostBreakdownChart();
                    } catch (error) {
                        console.error('Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•:', error);
                        showMessage('Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÂêéÁ´ØÊúçÂä°ÊòØÂê¶ËøêË°å', 'error');
                    }
                };
                
                // ËÆ°ÁÆóÊØèÊúàÂáÄÈîÄÂîÆÈ¢ù
                const calculateMonthlyNetSales = () => {
                    const salesDict = {};
                    
                    if (!salesData.value || salesData.value.length === 0) {
                        monthlyNetSales.value = {};
                        console.log('Ê≤°ÊúâÈîÄÂîÆÊï∞ÊçÆÔºåÊó†Ê≥ïËÆ°ÁÆóÊØèÊúàÂáÄÈîÄÂîÆÈ¢ù');
                        return;
                    }
                    
                    // ÈÅçÂéÜÈîÄÂîÆÊï∞ÊçÆ
                    salesData.value.forEach(item => {
                        const year = item.Year || item.year;
                        const month = item.Month || item.month;
                        const netSales = Number(item['Net Sales']) || 0;
                        
                        // Á°Æ‰øù year Âíå month Â≠òÂú®
                        if (!year || !month) return;
                        
                        // Ê†ºÂºèÂåñ‰∏∫ YYYY-MM
                        const yearMonth = `${year}-${String(month).padStart(2, '0')}`;
                        
                        // Á¥ØÂä†ÂáÄÈîÄÂîÆÈ¢ù
                        if (!salesDict[yearMonth]) {
                            salesDict[yearMonth] = 0;
                        }
                        salesDict[yearMonth] += netSales;
                    });
                    
                    monthlyNetSales.value = salesDict;
                    console.log('ÊØèÊúàÂáÄÈîÄÂîÆÈ¢ùÁªüËÆ°:', monthlyNetSales.value);
                    console.log('ÁªüËÆ°Êúà‰ªΩÊï∞Èáè:', Object.keys(monthlyNetSales.value).length);
                };
                
                // ËÆ°ÁÆó Disc ÊØèÊúàÂáÄÈîÄÂîÆÈ¢ù
                const calculateDiscMonthlyNetSales = () => {
                    const discSalesDict = {};
                    
                    if (!salesData.value || salesData.value.length === 0) {
                        discMonthlyNetSales.value = {};
                        console.log('Ê≤°ÊúâÈîÄÂîÆÊï∞ÊçÆÔºåÊó†Ê≥ïËÆ°ÁÆó Disc ÂáÄÈîÄÂîÆÈ¢ù');
                        return;
                    }
                    
                    // ÈÅçÂéÜÈîÄÂîÆÊï∞ÊçÆÔºåÁ≠õÈÄâ Disc Áõ∏ÂÖ≥Êï∞ÊçÆ
                    salesData.value.forEach(item => {
                        const year = item.Year || item.year;
                        const month = item.Month || item.month;
                        const netSales = Number(item['Net Sales']) || 0;
                        const itemGroup = item['Item - Item Group Full Name'] || '';
                        const itemCode = item['Item - Code'] || '';
                        
                        // Á°Æ‰øù year Âíå month Â≠òÂú®
                        if (!year || !month) return;
                        
                        // Á≠õÈÄâÊù°‰ª∂ÔºöItem Group ÂåÖÂê´ 2300 Êàñ 2330ÔºåÊàñËÄÖ Item Code ‰ª• 08„ÄÅ09„ÄÅ14 ÂºÄÂ§¥
                        const isDiscGroup = itemGroup.includes('2300') || itemGroup.includes('2330');
                        const isDiscCode = itemCode.startsWith('08') || itemCode.startsWith('09') || itemCode.startsWith('14');
                        
                        if (isDiscGroup || isDiscCode) {
                            // Ê†ºÂºèÂåñ‰∏∫ YYYY-MM
                            const yearMonth = `${year}-${String(month).padStart(2, '0')}`;
                            
                            // Á¥ØÂä† Disc ÂáÄÈîÄÂîÆÈ¢ù
                            if (!discSalesDict[yearMonth]) {
                                discSalesDict[yearMonth] = 0;
                            }
                            discSalesDict[yearMonth] += netSales;
                        }
                    });
                    
                    discMonthlyNetSales.value = discSalesDict;
                    console.log('Disc ÊØèÊúàÂáÄÈîÄÂîÆÈ¢ùÁªüËÆ°:', discMonthlyNetSales.value);
                    console.log('Disc ÁªüËÆ°Êúà‰ªΩÊï∞Èáè:', Object.keys(discMonthlyNetSales.value).length);
                };
                
                // ËÆ°ÁÆó Pads ÊØèÊúàÂáÄÈîÄÂîÆÈ¢ù
                const calculatePadsMonthlyNetSales = () => {
                    const padsSalesDict = {};
                    if (!salesData.value || salesData.value.length === 0) {
                        padsMonthlyNetSales.value = {};
                        return;
                    }
                    salesData.value.forEach(item => {
                        const year = item.Year || item.year;
                        const month = item.Month || item.month;
                        const netSales = Number(item['Net Sales']) || 0;
                        const itemCode = item['Item - Code'] || '';
                        if (!year || !month) return;
                        // Pads Á≠õÈÄâÊù°‰ª∂ÔºöItem Code ‰ª• P Êàñ S ÂºÄÂ§¥
                        const isPadsCode = itemCode.startsWith('P') || itemCode.startsWith('S');
                        if (isPadsCode) {
                            const yearMonth = `${year}-${String(month).padStart(2, '0')}`;
                            if (!padsSalesDict[yearMonth]) padsSalesDict[yearMonth] = 0;
                            padsSalesDict[yearMonth] += netSales;
                        }
                    });
                    padsMonthlyNetSales.value = padsSalesDict;
                    console.log('Pads ÊØèÊúàÂáÄÈîÄÂîÆÈ¢ùÁªüËÆ°:', Object.keys(padsMonthlyNetSales.value).length, '‰∏™Êúà');
                };
                
                // ËÆ°ÁÆó Moto ÊØèÊúàÂáÄÈîÄÂîÆÈ¢ù
                const calculateMotoMonthlyNetSales = () => {
                    const motoSalesDict = {};
                    if (!salesData.value || salesData.value.length === 0) {
                        motoMonthlyNetSales.value = {};
                        return;
                    }
                    salesData.value.forEach(item => {
                        const year = item.Year || item.year;
                        const month = item.Month || item.month;
                        const netSales = Number(item['Net Sales']) || 0;
                        const costCenter = (item['Cost Center'] || '').toString().trim();
                        if (!year || !month) return;
                        // Moto Á≠õÈÄâÊù°‰ª∂ÔºöCost Center ‰∏∫ 34N00037
                        const isMotoCostCenter = costCenter === '34N00037';
                        if (isMotoCostCenter) {
                            const yearMonth = `${year}-${String(month).padStart(2, '0')}`;
                            if (!motoSalesDict[yearMonth]) motoSalesDict[yearMonth] = 0;
                            motoSalesDict[yearMonth] += netSales;
                        }
                    });
                    motoMonthlyNetSales.value = motoSalesDict;
                    console.log('Moto ÊØèÊúàÂáÄÈîÄÂîÆÈ¢ùÁªüËÆ°:', Object.keys(motoMonthlyNetSales.value).length, '‰∏™Êúà');
                };
                
                // ËÆ°ÁÆó Fluid ÊØèÊúàÂáÄÈîÄÂîÆÈ¢ù
                const calculateFluidMonthlyNetSales = () => {
                    const fluidSalesDict = {};
                    if (!salesData.value || salesData.value.length === 0) {
                        fluidMonthlyNetSales.value = {};
                        return;
                    }
                    salesData.value.forEach(item => {
                        const year = item.Year || item.year;
                        const month = item.Month || item.month;
                        const netSales = Number(item['Net Sales']) || 0;
                        const itemGroup = item['Item - Item Group Full Name'] || '';
                        const itemCode = item['Item - Code'] || '';
                        if (!year || !month) return;
                        // Fluid Á≠õÈÄâÊù°‰ª∂ÔºöItem Group ÂåÖÂê´ 2500ÔºåÊàñ Item Code ‰ª• 12„ÄÅ13 ÂºÄÂ§¥
                        const isFluidGroup = itemGroup.includes('2500');
                        const isFluidCode = itemCode.startsWith('12') || itemCode.startsWith('13');
                        if (isFluidGroup || isFluidCode) {
                            const yearMonth = `${year}-${String(month).padStart(2, '0')}`;
                            if (!fluidSalesDict[yearMonth]) fluidSalesDict[yearMonth] = 0;
                            fluidSalesDict[yearMonth] += netSales;
                        }
                    });
                    fluidMonthlyNetSales.value = fluidSalesDict;
                    console.log('Fluid ÊØèÊúàÂáÄÈîÄÂîÆÈ¢ùÁªüËÆ°:', Object.keys(fluidMonthlyNetSales.value).length, '‰∏™Êúà');
                };
                
                const refreshData = () => {
                    loadData();
                    showMessage('Êï∞ÊçÆÂ∑≤Âà∑Êñ∞ÔºÅ');
                };
                
                const exportData = () => {
                    alert('Êï∞ÊçÆÂØºÂá∫ÂäüËÉΩÂ∑≤Ëß¶ÂèëÔºÅ');
                    // Âú®ÂÆûÈôÖÂ∫îÁî®‰∏≠ÔºåËøôÈáå‰ºöÂÆûÁé∞Êï∞ÊçÆÂØºÂá∫ÈÄªËæë
                };
                
                // Balance Êñá‰ª∂‰∏ä‰º†Áõ∏ÂÖ≥ÊñπÊ≥ï
                const triggerBalanceFileInput = () => {
                    balanceFileInput.value.click();
                };
                
                const toggleUploadArea = () => {
                    showUploadArea.value = !showUploadArea.value;
                };
                
                const toggleFilterGroups = () => {
                    showFilterGroups.value = !showFilterGroups.value;
                };
                
                const onBalanceFileSelect = (event) => {
                    const files = Array.from(event.target.files);
                    selectedBalanceFiles.value = files;
                    isBalanceDragover.value = false;
                };
                
                const onBalanceDrop = (event) => {
                    event.preventDefault();
                    const files = Array.from(event.dataTransfer.files);
                    selectedBalanceFiles.value = files;
                    isBalanceDragover.value = false;
                };
                
                const uploadBalanceFile = async () => {
                    if (selectedBalanceFiles.value.length === 0) {
                        showMessage('ËØ∑ÂÖàÈÄâÊã©Â∫ìÂ≠òÊñá‰ª∂', 'error');
                        return;
                    }
                    
                    isBalanceUploading.value = true;
                    
                    try {
                        const formData = new FormData();
                        selectedBalanceFiles.value.forEach(file => {
                            formData.append('files', file);
                        });
                        
                        const response = await fetch(`${API_BASE}/upload/balance`, {
                            method: 'POST',
                            body: formData
                        });
                        
                        const result = await response.json();
                        
                        if (response.ok) {
                            // ÊûÑÂª∫ËØ¶ÁªÜÁöÑ‰∏ä‰º†Ê∂àÊÅØ
                            let message = `ÊàêÂäü‰∏ä‰º† ${selectedBalanceFiles.value.length} ‰∏™Êñá‰ª∂! `;
                            if (result.uploadStats) {
                                const parts = [];
                                if (result.uploadStats.balance > 0) parts.push(`Balance: ${result.uploadStats.balance}`);
                                if (result.uploadStats.disc > 0) parts.push(`Disc: ${result.uploadStats.disc}`);
                                if (result.uploadStats.pads > 0) parts.push(`Pads: ${result.uploadStats.pads}`);
                                if (parts.length > 0) {
                                    message += `Êñ∞Â¢ûËÆ∞ÂΩï: ${parts.join(', ')}`;
                                }
                            } else {
                                message += `Êñ∞Â¢û ${result.newRecords} Êù°ËÆ∞ÂΩï`;
                            }
                            
                            showMessage(message);
                            balanceRecords.value = result.totalRecords || 0;
                            discRecords.value = result.uploadStats?.disc || 0;
                            padsRecords.value = result.uploadStats?.pads || 0;
                            
                            // ÈáçÊñ∞Âä†ËΩΩÊï∞ÊçÆ
                            await loadBalanceOverview();
                            if (selectedBalanceMonth.value) {
                                await loadDiscStats(selectedBalanceMonth.value);
                                await loadPadsStats(selectedBalanceMonth.value);
                            }
                            
                            // ÈáçÊñ∞Âä†ËΩΩÊâÄÊúâ DIO Êï∞ÊçÆ
                            await loadDioData();
                            await loadPadsDioData();
                            await loadMotoDioData();
                            await loadFluidDioData();
                            await loadTotalDioData();
                            
                            selectedBalanceFiles.value = [];
                            if (balanceFileInput.value) {
                                balanceFileInput.value.value = '';
                            }
                        } else {
                            showMessage('‰∏ä‰º†Â§±Ë¥•: ' + (result.error || 'Êú™Áü•ÈîôËØØ'), 'error');
                        }
                    } catch (error) {
                        showMessage('‰∏ä‰º†Â§±Ë¥•: ' + error.message, 'error');
                    } finally {
                        isBalanceUploading.value = false;
                    }
                };

                // Ê∏ÖÁ©∫Â∫ìÂ≠òÁõ∏ÂÖ≥Êï∞ÊçÆÔºàË∞ÉÁî®ÂêéÁ´Ø /api/clear/inventoryÔºâ
                const clearInventoryData = async () => {
                    try {
                        const resp = await fetch(`${API_BASE}/clear/inventory`, { method: 'POST' });
                        const result = await resp.json();
                        if (resp.ok) {
                            balanceOverview.value = { overall: [], goodsInTransit: [] };
                            selectedBalanceMonth.value = '';
                            balanceRecords.value = 0;
                            discAllData.value = [];
                            padsAllData.value = [];
                            motoAllData.value = [];
                            fluidAllData.value = [];
                            discMonths.value = [];
                            padsMonths.value = [];
                            motoMonths.value = [];
                            fluidMonths.value = [];
                            discStats.value = { value: 0, qty: 0 };
                            padsStats.value = { value: 0, qty: 0 };
                            motoStats.value = { value: 0, qty: 0 };
                            fluidStats.value = { value: 0, qty: 0 };
                            discRecords.value = 0;
                            padsRecords.value = 0;
                            motoRecords.value = 0;
                            fluidRecords.value = 0;
                            dioData.value = [];
                            dioMonths.value = [];
                            selectedDioStartMonth.value = '';
                            selectedDioEndMonth.value = '';
                            padsDioData.value = [];
                            padsDioMonths.value = [];
                            selectedPadsDioStartMonth.value = '';
                            selectedPadsDioEndMonth.value = '';
                            motoDioData.value = [];
                            motoDioMonths.value = [];
                            selectedMotoDioStartMonth.value = '';
                            selectedMotoDioEndMonth.value = '';
                            fluidDioData.value = [];
                            fluidDioMonths.value = [];
                            selectedFluidDioStartMonth.value = '';
                            selectedFluidDioEndMonth.value = '';
                            totalDioData.value = [];
                            totalDioMonths.value = [];
                            showMessage(result.message || 'Inventory Êï∞ÊçÆÂ∑≤Ê∏ÖÁ©∫');
                        } else {
                            showMessage('Ê∏ÖÁ©∫Â§±Ë¥•: ' + (result.error || 'Êú™Áü•ÈîôËØØ'), 'error');
                        }
                    } catch (e) {
                        showMessage('Ê∏ÖÁ©∫Â§±Ë¥•: ' + e.message, 'error');
                    }
                };
                
                const loadBalanceOverview = async () => {
                    try {
                        const response = await fetch(`${API_BASE}/data/balance-overview`);
                        const data = await response.json();
                        balanceOverview.value = data;
                        
                        // ÂêåÊó∂Âä†ËΩΩ Disc„ÄÅPads„ÄÅMoto Âíå Fluid ÁöÑÂèØÁî®Êúà‰ªΩÂíåÊï∞ÊçÆ
                        await loadDiscMonths();
                        await loadPadsMonths();
                        await loadMotoMonths();
                        await loadFluidMonths();
                        
                        // Ëá™Âä®ÈÄâÊã©ÊúÄÊñ∞ÁöÑÊúà‰ªΩÔºà‰ªéÊâÄÊúâinventoryÊñá‰ª∂‰∏≠Ôºâ
                        const allMonths = new Set();
                        if (data.overall && data.overall.length > 0) {
                            data.overall.forEach(item => allMonths.add(item.month));
                        }
                        discMonths.value.forEach(m => allMonths.add(m));
                        padsMonths.value.forEach(m => allMonths.add(m));
                        motoMonths.value.forEach(m => allMonths.add(m));
                        fluidMonths.value.forEach(m => allMonths.add(m));
                        
                        if (allMonths.size > 0) {
                            const sortedMonths = Array.from(allMonths).sort();
                            selectedBalanceMonth.value = sortedMonths[sortedMonths.length - 1];
                        }
                    } catch (error) {
                        console.error('Âä†ËΩΩ Balance Overview Â§±Ë¥•:', error);
                    }
                };
                
                const initCharts = () => {
                    console.log('ÂºÄÂßãÂàùÂßãÂåñÂõæË°®...');
                    
                    // ÈîÄÊØÅÁé∞ÊúâÂõæË°®
                    if (charts.value.unitPrice) charts.value.unitPrice.destroy();
                    if (charts.value.salesQuantity) charts.value.salesQuantity.destroy();
                    if (charts.value.grossSales) charts.value.grossSales.destroy();
                    if (charts.value.ebit) charts.value.ebit.destroy();
                    
                    // Ê†πÊçÆviewModeÂÜ≥ÂÆöÊï∞ÊçÆÊ∫êÂíåÂõæË°®Á±ªÂûã
                    const useMonthlyData = viewMode.value === 'monthly';
                    const chartType = useMonthlyData ? 'line' : 'bar';
                    
                    // ‰∏∫ÊâÄÊúâÁ≠õÈÄâÁªÑÁîüÊàêÊï∞ÊçÆÈõÜ
                    const datasets = filterGroups.value.map(group => {
                        const filteredData = getFilteredDataForGroup(group.filters);
                        const summary = useMonthlyData 
                            ? getMonthlySummaryForGroup(filteredData)
                            : getYearlySummaryForGroup(filteredData);
                        return { group, summary };
                    });
                    
                    // Ëé∑ÂèñÊâÄÊúâÊ†áÁ≠æ
                    const allLabelsSet = new Set();
                    datasets.forEach(({ summary }) => {
                        summary.forEach(item => {
                            allLabelsSet.add(useMonthlyData ? item.month : item.year);
                        });
                    });
                    const allLabels = Array.from(allLabelsSet).sort((a, b) => a - b);
                    const labels = allLabels.map(item => useMonthlyData ? `${item}Êúà` : item);
                    
                    if (allLabels.length > 0) {
                        console.log('ÂºÄÂßãÊ∏≤ÊüìÂõæË°®...');
                        
                        // Unit Price ÂõæË°®
                        if (unitPriceChart.value) {
                            const unitPriceCtx = unitPriceChart.value.getContext('2d');
                            const chartDatasets = datasets.map(({ group, summary }) => {
                                const dataMap = new Map(summary.map(s => [useMonthlyData ? s.month : s.year, s.unitPrice]));
                                const data = allLabels.map(label => dataMap.get(label) || 0);
                                return {
                                    label: group.name,
                                    data: data,
                                    backgroundColor: chartType === 'line' ? group.color.replace('0.7', '0.2') : group.color,
                                    borderColor: group.borderColor,
                                    borderWidth: 2,
                                    fill: chartType === 'line',
                                    tension: 0.4
                                };
                            });
                            
                            charts.value.unitPrice = new Chart(unitPriceCtx, {
                                type: chartType,
                                data: {
                                    labels: labels,
                                    datasets: chartDatasets
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        legend: { display: filterGroups.value.length > 1 },
                                        tooltip: {
                                            enabled: true,
                                            callbacks: {
                                                label: function(context) {
                                                    const label = context.dataset.label || '';
                                                    const value = context.parsed.y;
                                                    return `${label}: ¬•${formatNumber(value)}`;
                                                }
                                            }
                                        }
                                    },
                                    scales: {
                                        y: {
                                            beginAtZero: true,
                                            ticks: {
                                                callback: function(value) {
                                                    return '¬•' + formatNumber(value);
                                                }
                                            }
                                        }
                                    }
                                }
                            });
                        }
                        
                        // Sales Quantity ÂõæË°®
                        if (salesQuantityChart.value) {
                            const salesQuantityCtx = salesQuantityChart.value.getContext('2d');
                            const chartDatasets = datasets.map(({ group, summary }) => {
                                const dataMap = new Map(summary.map(s => [useMonthlyData ? s.month : s.year, s.salesQuantity]));
                                const data = allLabels.map(label => dataMap.get(label) || 0);
                                return {
                                    label: group.name,
                                    data: data,
                                    backgroundColor: chartType === 'line' ? group.color.replace('0.7', '0.2') : group.color,
                                    borderColor: group.borderColor,
                                    borderWidth: 2,
                                    fill: chartType === 'line',
                                    tension: 0.4
                                };
                            });
                            
                            charts.value.salesQuantity = new Chart(salesQuantityCtx, {
                                type: chartType,
                                data: {
                                    labels: labels,
                                    datasets: chartDatasets
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        legend: { display: filterGroups.value.length > 1 },
                                        tooltip: {
                                            enabled: true,
                                            callbacks: {
                                                label: function(context) {
                                                    const label = context.dataset.label || '';
                                                    const value = context.parsed.y;
                                                    return `${label}: ${formatNumber(value)}`;
                                                }
                                            }
                                        }
                                    },
                                    scales: {
                                        y: {
                                            beginAtZero: true,
                                            ticks: {
                                                callback: function(value) {
                                                    return formatNumber(value);
                                                }
                                            }
                                        }
                                    }
                                }
                            });
                        }
                        
                        // Gross Sales Amount ÂõæË°®
                        if (grossSalesChart.value) {
                            const grossSalesCtx = grossSalesChart.value.getContext('2d');
                            const chartDatasets = datasets.map(({ group, summary }) => {
                                const dataMap = new Map(summary.map(s => [useMonthlyData ? s.month : s.year, s.grossSalesAmount]));
                                const data = allLabels.map(label => dataMap.get(label) || 0);
                                return {
                                    label: group.name,
                                    data: data,
                                    backgroundColor: chartType === 'line' ? group.color.replace('0.7', '0.2') : group.color,
                                    borderColor: group.borderColor,
                                    borderWidth: 2,
                                    fill: chartType === 'line',
                                    tension: 0.4
                                };
                            });
                            
                            charts.value.grossSales = new Chart(grossSalesCtx, {
                                type: chartType,
                                data: {
                                    labels: labels,
                                    datasets: chartDatasets
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        legend: { display: filterGroups.value.length > 1 },
                                        tooltip: {
                                            enabled: true,
                                            callbacks: {
                                                label: function(context) {
                                                    const label = context.dataset.label || '';
                                                    const value = context.parsed.y;
                                                    return `${label}: ¬•${formatNumber(value)}`;
                                                }
                                            }
                                        }
                                    },
                                    scales: {
                                        y: {
                                            beginAtZero: true,
                                            ticks: {
                                                callback: function(value) {
                                                    return '¬•' + formatNumber(value);
                                                }
                                            }
                                        }
                                    }
                                }
                            });
                        }
                        
                        // EBIT ÂõæË°®
                        if (ebitChart.value) {
                            const ebitCtx = ebitChart.value.getContext('2d');
                            const chartDatasets = datasets.map(({ group, summary }) => {
                                const dataMap = new Map(summary.map(s => [useMonthlyData ? s.month : s.year, s.ebit]));
                                const data = allLabels.map(label => dataMap.get(label) || 0);
                                return {
                                    label: group.name,
                                    data: data,
                                    backgroundColor: chartType === 'line' ? group.color.replace('0.7', '0.2') : group.color,
                                    borderColor: group.borderColor,
                                    borderWidth: 2,
                                    fill: chartType === 'line',
                                    tension: 0.4
                                };
                            });
                            
                            charts.value.ebit = new Chart(ebitCtx, {
                                type: chartType,
                                data: {
                                    labels: labels,
                                    datasets: chartDatasets
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        legend: { display: filterGroups.value.length > 1 },
                                        tooltip: {
                                            enabled: true,
                                            callbacks: {
                                                label: function(context) {
                                                    const label = context.dataset.label || '';
                                                    const value = context.parsed.y;
                                                    return `${label}: ¬•${formatNumber(value)}`;
                                                }
                                            }
                                        }
                                    },
                                    scales: {
                                        y: {
                                            beginAtZero: true,
                                            ticks: {
                                                callback: function(value) {
                                                    return '¬•' + formatNumber(value);
                                                }
                                            }
                                        }
                                    }
                                }
                            });
                        }
                    }
                };
                
                // ÂàùÂßãÂåñÊàêÊú¨ÂàÜËß£Ê∞îÊ≥°Âõæ - ÊîØÊåÅÂ§öÁªÑÂØπÊØî
                const initCostBreakdownChart = () => {
                    console.log('ÂàùÂßãÂåñ Cost Breakdown ÂõæË°®, Á≠õÈÄâÁªÑÊï∞Èáè:', filterGroups.value.length);
                    
                    // Â¶ÇÊûúÊ≤°ÊúâÁ≠õÈÄâÁªÑÔºå‰∏çÊâßË°åÂàùÂßãÂåñ
                    if (!filterGroups.value || filterGroups.value.length === 0) {
                        console.log('Ê≤°ÊúâÁ≠õÈÄâÁªÑÔºåË∑≥Ëøá Cost Breakdown ÂõæË°®ÂàùÂßãÂåñ');
                        return;
                    }
                    
                    // ÈîÄÊØÅÊâÄÊúâÁé∞ÊúâÁöÑ cost breakdown ÂõæË°®
                    if (charts.value.costBreakdownCharts && Array.isArray(charts.value.costBreakdownCharts)) {
                        charts.value.costBreakdownCharts.forEach((chart, idx) => {
                            try {
                                if (chart && typeof chart.destroy === 'function') {
                                    console.log(`ÈîÄÊØÅ Cost Breakdown ÂõæË°® ${idx}`);
                                    chart.destroy();
                                }
                            } catch (e) {
                                console.warn(`ÈîÄÊØÅÂõæË°® ${idx} Êó∂Âá∫Èîô:`, e.message);
                            }
                        });
                    }
                    charts.value.costBreakdownCharts = [];
                    
                    // Á≠âÂæÖ DOM Êõ¥Êñ∞ÂêéÂÜçÂàõÂª∫Êñ∞ÂõæË°®
                    nextTick(() => {
                        setTimeout(() => {
                            console.log('ÂºÄÂßãÂàõÂª∫Êñ∞ÁöÑ Cost Breakdown ÂõæË°®');
                            const costMapping = {
                                'Rebate': 'Rebate Amount',
                                'Freight Out': 'Freight Out',
                                'Purchasing Material': 'Act Material Cost Total',
                                'Warehouse Operation': 'Contracted Work Total',
                                'Commission': 'Commission',
                                'Other SG&A': 'SG&A Total Exclud. Commission',
                                'EBIT': 'EBIT'
                            };
                            
                            const bubbleColors = [
                                'rgba(52, 152, 219, 0.7)',
                                'rgba(46, 204, 113, 0.7)',
                                'rgba(26, 188, 156, 0.7)',
                                'rgba(155, 89, 182, 0.7)',
                                'rgba(230, 126, 34, 0.7)',
                                'rgba(241, 196, 15, 0.7)',
                                'rgba(231, 76, 60, 0.7)'
                            ];
                            
                            // ‰∏∫ÊØè‰∏™Á≠õÈÄâÁªÑÂàõÂª∫ÊàêÊú¨ÂàÜËß£Êï∞ÊçÆ
                            filterGroups.value.forEach((group, groupIndex) => {
                                const canvasRef = costBreakdownChartRefs.value[groupIndex];
                                if (!canvasRef) {
                                    console.warn(`Canvas ref ${groupIndex} ‰∏çÂ≠òÂú®ÔºåË∑≥ËøáÂõæË°®ÂàõÂª∫`);
                                    return;
                                }
                                
                                // Á°Æ‰øù canvas ÂÖÉÁ¥†Â∑≤Ê∏≤Êüì‰∏îÊúâÊïà
                                if (!canvasRef.getContext) {
                                    console.warn(`Canvas ${groupIndex} Êó†ÊïàÊàñÊú™Ê∏≤Êüì`);
                                    return;
                                }
                                
                                // Ê£ÄÊü• canvas ÊòØÂê¶Â∑≤ÁªèÊúâÂÖ≥ËÅîÁöÑÂõæË°®
                                const existingChart = Chart.getChart(canvasRef);
                                if (existingChart) {
                                    console.log(`Canvas ${groupIndex} Â∑≤ÊúâÂõæË°®ÔºåÂÖàÈîÄÊØÅ`);
                                    try {
                                        existingChart.destroy();
                                    } catch (e) {
                                        console.warn(`ÈîÄÊØÅÂ∑≤Â≠òÂú®ÁöÑÂõæË°®Êó∂Âá∫Èîô:`, e.message);
                                    }
                                }
                                
                                const filteredData = getFilteredDataForGroup(group.filters);
                                if (!filteredData || filteredData.length === 0) {
                                    console.log(`ÁªÑ ${groupIndex} Êó†Êï∞ÊçÆ`);
                                    return;
                                }
                                
                                const netSalesAmt = filteredData.reduce((sum, item) => sum + (Number(item['Net Sales']) || 0), 0);
                                const breakdown = Object.entries(costMapping).map(([category, columnName]) => {
                                    const total = filteredData.reduce((sum, item) => sum + (Number(item[columnName]) || 0), 0);
                                    const percentage = netSalesAmt > 0 ? (total / netSalesAmt) * 100 : 0;
                                    return { category, value: total, percentage };
                                }).filter(item => item.value !== 0 || item.percentage !== 0);
                                
                                if (breakdown.length === 0) {
                                    console.log(`ÁªÑ ${groupIndex} Êó†ÂàÜËß£Êï∞ÊçÆ`);
                                    return;
                                }
                                
                                const ctx = canvasRef.getContext('2d');
                                const bubbleData = breakdown.map((item, index) => {
                                    const radius = 5 + (Math.abs(item.percentage) / 100) * 25;
                                    return { x: index, y: item.percentage, r: radius };
                                });
                                
                                console.log(`ÂàõÂª∫ÁªÑ ${groupIndex} ÁöÑÂõæË°®`);
                                try {
                                    const chart = new Chart(ctx, {
                            type: 'bubble',
                            data: {
                                datasets: breakdown.map((item, index) => ({
                                    label: item.category,
                                    data: [bubbleData[index]],
                                    backgroundColor: bubbleColors[index % bubbleColors.length],
                                    borderColor: bubbleColors[index % bubbleColors.length].replace('0.7', '1'),
                                    borderWidth: 2
                                }))
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                layout: {
                                    padding: {
                                        left: 10,
                                        right: 10,
                                        top: 10,
                                        bottom: 10
                                    }
                                },
                                plugins: {
                                    legend: {
                                        display: true,
                                        position: 'right',
                                        align: 'center',
                                        labels: {
                                            boxWidth: 15,
                                            boxHeight: 15,
                                            padding: 10,
                                            font: {
                                                size: 12
                                            },
                                            generateLabels: function() {
                                                return breakdown.map((item, index) => ({
                                                    text: `${item.category}: ${item.percentage.toFixed(1)}%`,
                                                    fillStyle: bubbleColors[index % bubbleColors.length],
                                                    strokeStyle: bubbleColors[index % bubbleColors.length].replace('0.7', '1'),
                                                    lineWidth: 2,
                                                    hidden: false,
                                                    index
                                                }));
                                            }
                                        }
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                const item = breakdown[context.datasetIndex];
                                                return [
                                                    `${item.category}`,
                                                    `Percentage: ${item.percentage.toFixed(2)}%`,
                                                    `Sales: ¬•${formatNumber(item.value)}`
                                                ];
                                            }
                                        }
                                    }
                                },
                                scales: {
                                    x: { display: false },
                                    y: {
                                        beginAtZero: true,
                                        title: { display: true, text: 'Âç†ÊØî (%)' },
                                        ticks: {
                                            callback: value => value.toFixed(1) + '%'
                                        }
                                    }
                                }
                            }
                        });
                        
                        charts.value.costBreakdownCharts.push(chart);
                                } catch (e) {
                                    console.error(`ÂàõÂª∫ÁªÑ ${groupIndex} ÁöÑÂõæË°®Êó∂Âá∫Èîô:`, e.message);
                                }
                    });
                        }, 100); // Âª∂Ëøü100msÁ°Æ‰øùDOMÂÆåÂÖ®Êõ¥Êñ∞
                    });
                };
                
                // ÁõëÂê¨Âô®
                watch(viewMode, () => {
                    // ÂΩìËßÜÂõæÊ®°ÂºèÊîπÂèòÊó∂
                    if (viewMode.value === 'monthly') {
                        // ÂàáÊç¢Âà∞ÊúàÂ∫¶ËßÜÂõæÊó∂,Â¶ÇÊûúÊ≤°ÊúâÈÄâÊã©Âπ¥‰ªΩ,Ëá™Âä®ÈÄâÊã©Á¨¨‰∏Ä‰∏™Âπ¥‰ªΩ
                        if (filterGroups.value[0] && filterGroups.value[0].filters.year === 'all' && yearData.value.length > 0) {
                            filterGroups.value[0].filters.year = yearData.value[0].year;
                        }
                    }
                    initCharts();
                    initCostBreakdownChart();
                });
                
                watch(filterGroups, () => {
                    // ÂΩìÁ≠õÈÄâÁªÑÊîπÂèòÊó∂,ÈáçÊñ∞ÁªòÂà∂ÂõæË°®
                    console.log('Á≠õÈÄâÁªÑÂ∑≤Êõ¥Êñ∞');
                    initCharts();
                    initCostBreakdownChart();
                }, { deep: true });
                
                // ÁõëÂê¨ currentView ÂèòÂåñÔºåÂàáÊç¢Âà∞ Inventory Êó∂Âä†ËΩΩÊï∞ÊçÆ
                watch(currentView, (newView) => {
                    if (newView === 'inventory') {
                        console.log('ÂàáÊç¢Âà∞ Inventory È°µÈù¢ÔºåÂ∞ùËØïÂä†ËΩΩ Balance Overview');
                        loadBalanceOverview();
                        loadDioData().then(() => {
                            nextTick(() => renderDioChart());
                        });
                        loadPadsDioData().then(() => {
                            nextTick(() => renderPadsDioChart());
                        });
                        loadMotoDioData().then(() => {
                            nextTick(() => renderMotoDioChart());
                        });
                        loadFluidDioData().then(() => {
                            nextTick(() => renderFluidDioChart());
                        });
                        // Ê∏≤ÊüìÁªÑÂêàÂõæË°®
                        Promise.all([
                            loadDioData(),
                            loadPadsDioData(),
                            loadMotoDioData(),
                            loadFluidDioData(),
                            loadTotalDioData()
                        ]).then(() => {
                            // ÂáÄÈîÄÂîÆÈ¢ùÂ∑≤ÁªèÂú®ÂêÑ‰∏™ loadXxxDioData() ÂáΩÊï∞‰∏≠‰ªéÂêéÁ´Ø DIO Êé•Âè£Ëé∑Âèñ
                            nextTick(() => renderCombinedDioChart());
                        });
                    }
                });

                // ÁõëÂê¨ DIO Êó•ÊúüËåÉÂõ¥ÈÄâÊã©ÂèòÂåñ
                watch([selectedDioStartMonth, selectedDioEndMonth], () => {
                    renderDioChart();
                });
                watch([selectedPadsDioStartMonth, selectedPadsDioEndMonth], () => {
                    renderPadsDioChart();
                });
                watch([selectedMotoDioStartMonth, selectedMotoDioEndMonth], () => {
                    renderMotoDioChart();
                });
                watch([selectedFluidDioStartMonth, selectedFluidDioEndMonth], () => {
                    renderFluidDioChart();
                });
                
                // ÁõëÂê¨ÁªÑÂêàÂõæË°®ÁöÑÊó•ÊúüËåÉÂõ¥ÂèòÂåñ
                watch([selectedCombinedDioStartMonth, selectedCombinedDioEndMonth], () => {
                    renderCombinedDioChart();
                });

                // ÁõëÂê¨ dioData ÂèòÂåñ
                watch(dioData, () => {
                    nextTick(() => renderDioChart());
                });
                watch(padsDioData, () => {
                    nextTick(() => renderPadsDioChart());
                });
                watch(motoDioData, () => {
                    nextTick(() => renderMotoDioChart());
                });
                watch(fluidDioData, () => {
                    nextTick(() => renderFluidDioChart());
                });
                
                // ÁõëÂê¨ÊâÄÊúâDIOÊï∞ÊçÆÂèòÂåñ‰ª•Êõ¥Êñ∞ÁªÑÂêàÂõæË°®
                watch([dioData, padsDioData, motoDioData, fluidDioData, totalDioData, monthlyNetSales, discMonthlyNetSales, padsMonthlyNetSales, motoMonthlyNetSales, fluidMonthlyNetSales], () => {
                    nextTick(() => renderCombinedDioChart());
                });
                
                // ÁîüÂëΩÂë®Êúü
                onMounted(() => {
                    // ‰∏çËá™Âä®Âä†ËΩΩÊï∞ÊçÆ,Á≠âÂæÖÁî®Êà∑‰∏ä‰º†Êñá‰ª∂
                    console.log('È°µÈù¢Â∑≤Âä†ËΩΩ,ËØ∑‰∏ä‰º†ExcelÊñá‰ª∂');
                });
                
                // ËøîÂõûÊï∞ÊçÆÂíåÊñπÊ≥ï
                return {
                    unitPriceChart,
                    salesQuantityChart,
                    grossSalesChart,
                    ebitChart,
                    costBreakdownChart,
                    costBreakdownChartRefs,
                    fileInput,
                    viewMode,
                    currentView,
                    filters,
                    filterGroups,
                    stats,
                    salesData,
                    productData,
                    regionData,
                    yearData,
                    yearlySummaryData,
                    monthlySummaryData,
                    costBreakdownData,
                    filteredStats,
                    filteredSalesData,
                    filteredYearlySummary,
                    filteredMonthlySummary,
                    // ÂÆ¢Êà∑ & Country ‰∏ãÊãâÈÄâÈ°π
                    customerOptions,
                    countryOptions,
                    itemGroupOptions,
                    itemCodeOptions,
                    itemCodeSearch,
                    filteredItemCodeOptions,
                    filteredCostBreakdown,
                    selectedFiles,
                    isUploading,
                    isDragover,
                    message,
                    messageType,
                    vueVersion,
                    // Balance Áõ∏ÂÖ≥
                    balanceFileInput,
                    balanceOverviewChart,
                    selectedBalanceFiles,
                    isBalanceUploading,
                    isBalanceDragover,
                    showUploadArea,
                    showFilterGroups,
                    toggleFilterGroups,
                    balanceRecords,
                    balanceOverview,
                    selectedBalanceMonth,
                    balanceMonthOptions,
                    selectedBalanceData,
                    selectedCategoryMonth,
                    categoryMonthOptions,
                    discStats,
                    padsStats,
                    discStatsAll,
                    padsStatsAll,
                    discStatsByMonth,
                    padsStatsByMonth,
                    motoStatsByMonth,
                    fluidStatsByMonth,
                    discMonths,
                    padsMonths,
                    motoMonths,
                    fluidMonths,
                    motoStatsAll,
                    fluidStatsAll,
                    latestOverall,
                    latestGoodsInTransit,
                    triggerBalanceFileInput,
                    toggleUploadArea,
                    onBalanceFileSelect,
                    onBalanceDrop,
                    uploadBalanceFile,
                    loadBalanceOverview,
                    discRecords,
                    padsRecords,
                    motoRecords,
                    fluidRecords,
                    // DIO  - Disc
                    dioData,
                    dioMonths,
                    selectedDioStartMonth,
                    selectedDioEndMonth,
                    dioChartRef,
                    loadDioData,
                    renderDioChart,
                    // DIO  - Pads
                    padsDioData,
                    padsDioMonths,
                    selectedPadsDioStartMonth,
                    selectedPadsDioEndMonth,
                    padsDioChartRef,
                    loadPadsDioData,
                    renderPadsDioChart,
                    // DIO  - Moto
                    motoDioData,
                    motoDioMonths,
                    selectedMotoDioStartMonth,
                    selectedMotoDioEndMonth,
                    motoDioChartRef,
                    loadMotoDioData,
                    renderMotoDioChart,
                    // DIO  - Fluid
                    fluidDioData,
                    fluidDioMonths,
                    selectedFluidDioStartMonth,
                    selectedFluidDioEndMonth,
                    fluidDioChartRef,
                    loadFluidDioData,
                    renderFluidDioChart,
                    // DIO ÁªÑÂêàÂõæË°®
                    combinedDioChartRef,
                    combinedDioMonths,
                    selectedCombinedDioStartMonth,
                    selectedCombinedDioEndMonth,
                    dioVisibility,
                    activeDioCategory,
                    toggleDioCategory,
                    renderCombinedDioChart,
                    // Total DIO
                    totalDioData,
                    totalDioMonths,
                    totalDioChartRef,
                    loadTotalDioData,
                    // ÊØèÊúàÂáÄÈîÄÂîÆÈ¢ù
                    monthlyNetSales,
                    calculateMonthlyNetSales,
                    // Disc ÊØèÊúàÂáÄÈîÄÂîÆÈ¢ù
                    discMonthlyNetSales,
                    calculateDiscMonthlyNetSales,
                    // Pads ÊØèÊúàÂáÄÈîÄÂîÆÈ¢ù
                    padsMonthlyNetSales,
                    calculatePadsMonthlyNetSales,
                    // Moto ÊØèÊúàÂáÄÈîÄÂîÆÈ¢ù
                    motoMonthlyNetSales,
                    calculateMotoMonthlyNetSales,
                    // Fluid ÊØèÊúàÂáÄÈîÄÂîÆÈ¢ù
                    fluidMonthlyNetSales,
                    calculateFluidMonthlyNetSales,
                    // ÈÄöÁî®ÊñπÊ≥ï
                    formatNumber,
                    triggerFileInput,
                    onFileSelect,
                    onDrop,
                    uploadFile,
                    loadSampleData,
                    clearData,
                    refreshData,
                    exportData,
                    showMessage,
                    totalRecords,
                    addFilterGroup,
                    removeFilterGroup
                    ,clearInventoryData
                };
            }
        }).mount('#app');
    </script>
</body>
</html>